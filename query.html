<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="preload" as="font" href="/_next/static/media/035951aefad7b653-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/3478b6abef19b3b3-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/d50fa1c781f60195-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/8dc07470c12386b5.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/3457e45db263924b.css" data-precedence="next"/><title>spencerschack.com</title><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" noModule=""></script></head><body class="__variable_f30994 __className_8fb110"><div class="styles_root__FGv06"><section id="Demo" class="styles_container__S0Ptr"><div class="styles_card__xSmZP"><div class="styles_side__fA9nv"><time class="styles_date__GnoPJ">June 2023</time><h1 class="styles_title__wEJ_p">SQL Interfaces &amp;<br/>The 80/20 Rule</h1><h2 class="styles_tagline__yu5i4">Developing a minimal interface for composing and executing SQL queries</h2></div><div class="styles_main__JNmlP"><div class="styles_editor__vc_fu"><div class="styles_editor__E3lMc"><div class="styles_container__jy1l_"><div class="styles_textarea__v6lSi" style="position:relative;text-align:left;box-sizing:border-box;padding:0;overflow:hidden"><pre aria-hidden="true" style="margin:0;border:0;background:none;box-sizing:inherit;display:inherit;font-family:inherit;font-size:inherit;font-style:inherit;font-variant-ligatures:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;tab-size:inherit;text-indent:inherit;text-rendering:inherit;text-transform:inherit;white-space:pre-wrap;word-break:keep-all;overflow-wrap:break-word;position:relative;pointer-events:none;padding-top:0;padding-right:0;padding-bottom:0;padding-left:0"><div class="styles_line__aOS_T "><span class="styles_keyword__RcxoL">const</span><span class=""> </span><span class=" styles_function__1eRN9">orders</span><span class=""> </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="">interval</span><span class=""> </span><span class="styles_operator__ty4_w">=&gt;</span><span class=""> $</span><span class="  styles_string__bCSta">`</span><span class=" styles_string__bCSta"></span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta">  SELECT name, SUM(quantity * price) AS revenue, COUNT(*) AS sales</span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta">  FROM products JOIN orders USING (product_id)</span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta">  GROUP BY name, STRFTIME(</span><span class="   ">${</span><span class=" ">interval</span><span class="   ">}</span><span class=" styles_string__bCSta">, date)</span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta"></span><span class="  styles_string__bCSta">`</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_keyword__RcxoL">const</span><span class=""> </span><span class=" styles_function__1eRN9">stats</span><span class=""> </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="">column</span><span class=""> </span><span class="styles_operator__ty4_w">=&gt;</span><span class=""> $</span><span class="  styles_string__bCSta">`</span><span class=" styles_string__bCSta"></span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta">  ROUND(AVG(</span><span class="   ">${</span><span class=" ">column</span><span class="   ">}</span><span class=" styles_string__bCSta">)) AS avg_</span><span class="   ">${</span><span class=" ">column</span><span class="   ">}</span><span class=" styles_string__bCSta">,</span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta">  MAX(</span><span class="   ">${</span><span class=" ">column</span><span class="   ">}</span><span class=" styles_string__bCSta">) AS max_</span><span class="   ">${</span><span class=" ">column</span><span class="   ">}</span><span class=" styles_string__bCSta"></span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta"></span><span class="  styles_string__bCSta">`</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_keyword__RcxoL">return</span><span class=""> $</span><span class="  styles_string__bCSta">`</span><span class=" styles_string__bCSta"></span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta">  SELECT name, </span><span class="   ">${</span><span class="  styles_function__1eRN9">stats</span><span class="  ">(</span><span class=" ">$</span><span class="    styles_string__bCSta">`</span><span class="   styles_string__bCSta">revenue</span><span class="    styles_string__bCSta">`</span><span class="  ">)</span><span class="   ">}</span><span class=" styles_string__bCSta">, </span><span class="   ">${</span><span class="  styles_function__1eRN9">stats</span><span class="  ">(</span><span class=" ">$</span><span class="    styles_string__bCSta">`</span><span class="   styles_string__bCSta">sales</span><span class="    styles_string__bCSta">`</span><span class="  ">)</span><span class="   ">}</span><span class=" styles_string__bCSta"></span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta">  FROM (</span><span class="   ">${</span><span class="  styles_function__1eRN9">orders</span><span class="  ">(</span><span class="  styles_string__bCSta">&#x27;%Y&#x27;</span><span class="  ">)</span><span class="   ">}</span><span class=" styles_string__bCSta">)</span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta">  GROUP BY name</span></div><div class="styles_line__aOS_T "><span class=" styles_string__bCSta"></span><span class="  styles_string__bCSta">`</span><span class="">;</span></div></pre><textarea style="margin:0;border:0;background:none;box-sizing:inherit;display:inherit;font-family:inherit;font-size:inherit;font-style:inherit;font-variant-ligatures:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;tab-size:inherit;text-indent:inherit;text-rendering:inherit;text-transform:inherit;white-space:pre-wrap;word-break:keep-all;overflow-wrap:break-word;position:absolute;top:0;left:0;height:100%;width:100%;resize:none;color:inherit;overflow:hidden;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-text-fill-color:transparent;padding-top:0;padding-right:0;padding-bottom:0;padding-left:0" class="npm__react-simple-code-editor__textarea" autoCapitalize="off" autoComplete="off" autoCorrect="off" spellCheck="false" data-gramm="false">const orders = interval =&gt; $`
  SELECT name, SUM(quantity * price) AS revenue, COUNT(*) AS sales
  FROM products JOIN orders USING (product_id)
  GROUP BY name, STRFTIME(${interval}, date)
`;
const stats = column =&gt; $`
  ROUND(AVG(${column})) AS avg_${column},
  MAX(${column}) AS max_${column}
`;
return $`
  SELECT name, ${stats($`revenue`)}, ${stats($`sales`)}
  FROM (${orders(&#x27;%Y&#x27;)})
  GROUP BY name
`;</textarea><style>
/**
 * Reset the text fill color so that placeholder is visible
 */
.npm__react-simple-code-editor__textarea:empty {
  -webkit-text-fill-color: inherit !important;
}

/**
 * Hack to apply on some CSS on IE10 and IE11
 */
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
  /**
    * IE doesn't support '-webkit-text-fill-color'
    * So we use 'color: transparent' to make the text transparent on IE
    * Unlike other browsers, it doesn't affect caret color in IE
    */
  .npm__react-simple-code-editor__textarea {
    color: transparent !important;
  }

  .npm__react-simple-code-editor__textarea::selection {
    background-color: #accef7 !important;
    color: transparent !important;
  }
}
</style></div></div></div><button class="styles_loadContainer__Xg_Dt"><div class="styles_loadButton__CoOlg"><span class="styles_loadButtonIcon__sfcAu">&gt;</span> <!-- -->Load Live Demo</div></button></div><div class="styles_results__IX3in"><div class="styles_results__EXQ9C"><table><tbody><tr><th>name</th><th>avg_revenue</th><th>max_revenue</th><th>avg_sales</th><th>max_sales</th></tr><tr><td>Bacon</td><td>6160</td><td>15640</td><td>4</td><td>6</td></tr><tr><td>Ball</td><td>4902</td><td>8564</td><td>4</td><td>6</td></tr><tr><td>Car</td><td>3231</td><td>8506</td><td>2</td><td>5</td></tr><tr><td>Chair</td><td>1962</td><td>4550</td><td>4</td><td>8</td></tr><tr><td>Chicken</td><td>3960</td><td>7618</td><td>4</td><td>5</td></tr><tr><td>Computer</td><td>4689</td><td>9466</td><td>4</td><td>6</td></tr><tr><td>Fish</td><td>1672</td><td>2926</td><td>1</td><td>2</td></tr><tr><td>Gloves</td><td>3088</td><td>5018</td><td>3</td><td>3</td></tr><tr><td>Mouse</td><td>4283</td><td>10020</td><td>4</td><td>9</td></tr><tr><td>Pizza</td><td>3819</td><td>6820</td><td>2</td><td>2</td></tr><tr><td>Salad</td><td>127</td><td>320</td><td>1</td><td>2</td></tr><tr><td>Tuna</td><td>8808</td><td>14055</td><td>3</td><td>6</td></tr></tbody></table></div></div></div></div></section><div class="styles_container__b_OzL"><ol class="styles_toc__bIATy"><li><a href="#Demo" class="styles_intersect__XwP0Z">Demo</a></li><li><a href="#Introduction">Introduction</a></li><li><a href="#Motivation">Motivation</a></li><li><a href="#Experimentation">Experimentation</a></li><li><a href="#Implementation">Implementation</a></li><li><a href="#Query%20Composition">Query Composition</a></li><li><a href="#Async%20Iteration">Async Iteration</a></li><li><a href="#Conclusion">Conclusion</a></li></ol><div class="styles_content__hvl__"><section id="Introduction"><h2>Introduction</h2><p>A better API is sometimes the one with fewer features. Often the development effort of software is dominated by the long tail of features. You can get 80% of the features for 20% of the work...if you can do without every last feature.</p><p>Writing SQL queries is often an inevitable part of software development. SQL is either written by hand or with the help of query builders. Query builders, such as<!-- --> <a href="https://guides.rubyonrails.org/active_record_basics.html">ActiveRecord</a> <!-- -->or <a href="https://knexjs.org/guide/query-builder.html#knex">Knex</a>, are tools that help to create queries through an API native to the programming language you&#x27;re executing the queries from.</p></section><section id="Motivation"><h2>Motivation</h2><p>Query builders can be very useful when writing simple queries:</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_"><div class="styles_line__aOS_T "><span class="styles_function__1eRN9">knex</span><span class="">(</span><span class="styles_string__bCSta">&#x27;posts&#x27;</span><span class="">)</span><span class="">.</span><span class="styles_function__1eRN9">where</span><span class="">(</span><span class="styles_string__bCSta">&#x27;category_id&#x27;</span><span class="">,</span><span class=""> </span><span class="styles_number__dhAtQ">42</span><span class="">)</span><span class="">.</span><span class="styles_function__1eRN9">orderBy</span><span class="">(</span><span class="styles_string__bCSta">&#x27;created_at&#x27;</span><span class="">)</span><span class="">;</span></div></div></div><p>However, this approach does have some downsides:</p><ul><li>Every query feature in your target database needs a corresponding query builder API. The effort to develop, maintain, and learn how to use the query builder is coupled with how many features you want to use.</li><li>SQL is a standardized, widely-used language that enables developers to share their ability to query databases across projects and teams. The benefits of the widespread familiarity with SQL is lost when each query builder has a unique API.</li></ul></section><section id="Experimentation"><h2>Experimentation</h2><p>Writing queries by hand with strings and variable interpolation is not the answer either because of the need to mitigate SQL injestion and correctly serialize the variables.</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_"><div class="styles_line__aOS_T "><span class="styles_comment__UauEA">// This is susceptible to SQL injection and wouldn&#x27;t</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_comment__UauEA">// correctly interpolate string literals.</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">connection</span><span class="">.</span><span class="styles_function__1eRN9">execute</span><span class="">(</span><span class="  styles_string__bCSta">`</span><span class=" styles_string__bCSta">SELECT * FROM users WHERE id = </span><span class="   ">${</span><span class=" ">id</span><span class="   ">}</span><span class="  styles_string__bCSta">`</span><span class="">)</span><span class="">;</span></div></div></div><p>Javascript does have a language feature that helps these solves issues. Tagged template literals:</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_"><div class="styles_line__aOS_T "><span class="">query</span><span class="  styles_string__bCSta">`</span><span class=" styles_string__bCSta">SELECT * FROM users WHERE id = </span><span class="   ">${</span><span class=" ">id</span><span class="   ">}</span><span class=" styles_string__bCSta"> </span><span class="  styles_string__bCSta">`</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_comment__UauEA">// is equivalent to</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_function__1eRN9">query</span><span class="">(</span><span class="">[</span><span class="styles_string__bCSta">&quot;SELECT * FROM users WHERE id = &quot;</span><span class="">,</span><span class=""> </span><span class="styles_string__bCSta">&quot;&quot;</span><span class="">]</span><span class="">,</span><span class=""> </span><span class="">[</span><span class="">id</span><span class="">]</span><span class="">)</span><span class="">;</span></div></div></div><p>I wanted to create an interface for writing SQL to work like it was part of the source code instead of just a string parameter. Similar to JSX where building html elements is baked into the language for better ergonomics. The end goal was something like this:</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_"><div class="styles_line__aOS_T "><span class="styles_keyword__RcxoL">const</span><span class=""> </span><span class="">[</span><span class="">result</span><span class="">]</span><span class=""> </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="styles_keyword__RcxoL">await</span><span class=""> query</span><span class="  styles_string__bCSta">`</span><span class=" styles_string__bCSta">SELECT * FROM users WHERE id = </span><span class="   ">${</span><span class=" ">id</span><span class="   ">}</span><span class="  styles_string__bCSta">`</span><span class="">;</span></div></div></div></section><section id="Implementation"><h2>Implementation</h2><p>My first step was creating something like<!-- --> <a href="https://github.com/blakeembrey/sql-template-tag">sql-template-tag</a> <!-- -->using<!-- --> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates">tagged template literals</a>. This single line function already completed about 80% of the API.</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_"><div class="styles_line__aOS_T "><span class="styles_keyword__RcxoL">function</span><span class=""> </span><span class="styles_function__1eRN9">query</span><span class="">(</span><span class="">parts</span><span class=" ">,</span><span class=""> </span><span class=" styles_operator__ty4_w">...</span><span class="">binds</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">  </span><span class="styles_keyword__RcxoL">return</span><span class=""> connection</span><span class="">.</span><span class="styles_function__1eRN9">execute</span><span class="">(</span><span class="">{</span><span class=""> </span><span class=" styles_property__BaBI9">sql</span><span class="styles_operator__ty4_w">:</span><span class=""> parts</span><span class="">.</span><span class="styles_function__1eRN9">join</span><span class="">(</span><span class="styles_string__bCSta">&quot;$&quot;</span><span class="">)</span><span class="">,</span><span class=""> binds </span><span class="">}</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="">}</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">
</span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_keyword__RcxoL">const</span><span class=""> </span><span class="">[</span><span class="">result</span><span class="">]</span><span class=""> </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="styles_keyword__RcxoL">await</span><span class=""> query</span><span class="  styles_string__bCSta">`</span><span class=" styles_string__bCSta">SELECT * FROM users WHERE id = </span><span class="   ">${</span><span class=" ">id</span><span class="   ">}</span><span class="  styles_string__bCSta">`</span><span class="">;</span></div></div></div><p>The first thing I needed to fix was that a query would execute immediately, right when it was defined. It would be better if it would run only when <code>await</code>ed. This can be accomplished with &quot;lazy&quot; promises by creating an object with a <code>then</code> <!-- -->method.</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_ styles_highlit__JjWSK"><div class="styles_line__aOS_T "><span class="styles_keyword__RcxoL">function</span><span class=""> </span><span class="styles_function__1eRN9">query</span><span class="">(</span><span class="">parts</span><span class=" ">,</span><span class=""> </span><span class=" styles_operator__ty4_w">...</span><span class="">binds</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">    </span><span class="styles_function__1eRN9">then</span><span class="">(</span><span class=" styles_operator__ty4_w">...</span><span class="">args</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">      </span><span class="styles_keyword__RcxoL">return</span><span class=""> connection</span></div><div class="styles_line__aOS_T "><span class="">        </span><span class="">.</span><span class="styles_function__1eRN9">execute</span><span class="">(</span><span class="">{</span><span class=""> </span><span class=" styles_property__BaBI9">sql</span><span class="styles_operator__ty4_w">:</span><span class=""> parts</span><span class="">.</span><span class="styles_function__1eRN9">join</span><span class="">(</span><span class="styles_string__bCSta">&quot;$&quot;</span><span class="">)</span><span class="">,</span><span class=""> binds </span><span class="">}</span><span class="">)</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">        </span><span class="">.</span><span class="styles_function__1eRN9">then</span><span class="">(</span><span class="styles_operator__ty4_w">...</span><span class="">args</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">    </span><span class="">}</span></div></div></div><p>I wanted this tool to be database agnostic so I extracted the execution logic and renamed the helper to <code>$</code> to be more succinct:</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_ styles_highlit__JjWSK"><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="styles_keyword__RcxoL">const</span><span class=""> </span><span class=" styles_function__1eRN9">makeQuery</span><span class=""> </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="">execute</span><span class=""> </span><span class="styles_operator__ty4_w">=&gt;</span><span class=""> </span><span class="styles_keyword__RcxoL">function</span><span class=""> </span><span class="styles_function__1eRN9">query</span><span class="">(</span><span class="">parts</span><span class=" ">,</span><span class=""> </span><span class=" styles_operator__ty4_w">...</span><span class="">binds</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">  </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">    </span><span class="styles_function__1eRN9">then</span><span class="">(</span><span class=" styles_operator__ty4_w">...</span><span class="">args</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="styles_function__1eRN9">execute</span><span class="">(</span><span class="">parts</span><span class="">,</span><span class=""> binds</span><span class="">)</span><span class="">.</span><span class="styles_function__1eRN9">then</span><span class="">(</span><span class="styles_operator__ty4_w">...</span><span class="">args</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">    </span><span class="">}</span><span class="">,</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">  </span><span class="">}</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="">}</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">
</span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class=""></span><span class="styles_keyword__RcxoL">const</span><span class=""> $ </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="styles_function__1eRN9">makeQuery</span><span class="">(</span><span class="">(</span><span class="">parts</span><span class=" ">,</span><span class=""> binds</span><span class="">)</span><span class=""> </span><span class="styles_operator__ty4_w">=&gt;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  connection</span><span class="">.</span><span class="styles_function__1eRN9">execute</span><span class="">(</span><span class="">{</span><span class=""> </span><span class=" styles_property__BaBI9">sql</span><span class="styles_operator__ty4_w">:</span><span class=""> parts</span><span class="">.</span><span class="styles_function__1eRN9">join</span><span class="">(</span><span class="styles_string__bCSta">&quot;$&quot;</span><span class="">)</span><span class="">,</span><span class=""> binds </span><span class="">}</span><span class="">)</span><span class="">,</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class=""></span><span class="">)</span></div></div></div></section><section id="Query%20Composition"><h2>Query Composition</h2><p>There was a key feature that was missing: query composition. So far, the helper supported interpolating variables, but not other subqueries themselves.</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_"><div class="styles_line__aOS_T "><span class="styles_comment__UauEA">// Not (yet) supported</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_keyword__RcxoL">const</span><span class=""> lastDay </span><span class="styles_operator__ty4_w">=</span><span class=""> query</span><span class="  styles_string__bCSta">`</span><span class=" styles_string__bCSta">created_at &gt; current_timestamp() - interval &#x27;1&#x27; day</span><span class="  styles_string__bCSta">`</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_keyword__RcxoL">const</span><span class=""> results </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="styles_keyword__RcxoL">await</span><span class=""> query</span><span class="  styles_string__bCSta">`</span><span class=" styles_string__bCSta">SELECT * FROM ads WHERE </span><span class="   ">${</span><span class=" ">lastDay</span><span class="   ">}</span><span class="  styles_string__bCSta">`</span><span class="">;</span></div></div></div><p>Nested queries were more difficult to support. There were two things that needed to be done to support them: determine a nested query from a variable bind and unnesting the nested queries.</p><p>We can determine a query from other types with a Javascript idiom where we use a <code>Symbol</code> to allow conversion of a value into another type. This pattern is used by Javascript to implement iteration via<!-- --> <code>Symbol.iterator</code>.</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_ styles_highlit__JjWSK"><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="styles_keyword__RcxoL">const</span><span class=""> toQuery </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="styles_keyword__RcxoL">new</span><span class=""> </span><span class="">Symbol</span><span class="">(</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">
</span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_keyword__RcxoL">const</span><span class=""> </span><span class=" styles_function__1eRN9">makeQuery</span><span class=""> </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="">execute</span><span class=""> </span><span class="styles_operator__ty4_w">=&gt;</span><span class=""> </span><span class="styles_keyword__RcxoL">function</span><span class=""> </span><span class="styles_function__1eRN9">query</span><span class="">(</span><span class="">parts</span><span class=" ">,</span><span class=""> </span><span class=" styles_operator__ty4_w">...</span><span class="">binds</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">  </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">    </span><span class="">[</span><span class="">toQuery</span><span class="">]</span><span class="">(</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="">[</span><span class="">parts</span><span class="">,</span><span class=""> binds</span><span class="">]</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">    </span><span class="">}</span><span class="">,</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">    </span><span class="styles_function__1eRN9">then</span><span class="">(</span><span class=" styles_operator__ty4_w">...</span><span class="">args</span><span class="">)</span><span class=""> </span><span class="">{</span></div></div></div><p>To unnest the nested query, we have to iterate over the static parts of the query and the binds. In addition to flattening the top level and nested parts and binds, the first and last parts of each nested query must be concatenated to the surrounding parts in the top level query.</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_ styles_highlit__JjWSK"><div class="styles_line__aOS_T "><span class="styles_keyword__RcxoL">const</span><span class=""> toQuery </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="styles_keyword__RcxoL">new</span><span class=""> </span><span class="">Symbol</span><span class="">(</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">
</span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class=""></span><span class="styles_keyword__RcxoL">function</span><span class=""> </span><span class="styles_function__1eRN9">unnest</span><span class="">(</span><span class=" ">[</span><span class="">firstPart</span><span class=" ">,</span><span class=""> </span><span class=" styles_operator__ty4_w">...</span><span class="">nestedParts</span><span class=" ">]</span><span class=" ">,</span><span class=""> nestedBinds</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  </span><span class="styles_keyword__RcxoL">const</span><span class=""> parts </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="">[</span><span class="">firstPart</span><span class="">]</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  </span><span class="styles_keyword__RcxoL">const</span><span class=""> binds </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="">[</span><span class="">]</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  nestedBinds</span><span class="">.</span><span class="styles_function__1eRN9">forEach</span><span class="">(</span><span class="">(</span><span class="">bind</span><span class=" ">,</span><span class=""> index</span><span class="">)</span><span class=""> </span><span class="styles_operator__ty4_w">=&gt;</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">    </span><span class="styles_keyword__RcxoL">if</span><span class=""> </span><span class="">(</span><span class="">bind </span><span class="styles_operator__ty4_w">&amp;&amp;</span><span class=""> </span><span class="styles_keyword__RcxoL">typeof</span><span class=""> bind </span><span class="styles_operator__ty4_w">===</span><span class=""> </span><span class="styles_string__bCSta">&quot;object&quot;</span><span class=""> </span><span class="styles_operator__ty4_w">&amp;&amp;</span><span class=""> toQuery </span><span class="styles_keyword__RcxoL">in</span><span class=""> bind</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      </span><span class="styles_keyword__RcxoL">const</span><span class=""> </span><span class="">[</span><span class="">bindParts</span><span class="">,</span><span class=""> bindBinds</span><span class="">]</span><span class=""> </span><span class="styles_operator__ty4_w">=</span><span class=""> bind</span><span class="">[</span><span class="">toQuery</span><span class="">]</span><span class="">(</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      parts</span><span class="">[</span><span class="">parts</span><span class="">.</span><span class="">length </span><span class="styles_operator__ty4_w">-</span><span class=""> </span><span class="styles_number__dhAtQ">1</span><span class="">]</span><span class=""> </span><span class="styles_operator__ty4_w">+=</span><span class=""> bindParts</span><span class="">[</span><span class="styles_number__dhAtQ">0</span><span class="">]</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      parts</span><span class="">.</span><span class="styles_function__1eRN9">push</span><span class="">(</span><span class="styles_operator__ty4_w">...</span><span class="">bindParts</span><span class="">.</span><span class="styles_function__1eRN9">slice</span><span class="">(</span><span class="styles_number__dhAtQ">1</span><span class="">)</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      parts</span><span class="">[</span><span class="">parts</span><span class="">.</span><span class="">length </span><span class="styles_operator__ty4_w">-</span><span class=""> </span><span class="styles_number__dhAtQ">1</span><span class="">]</span><span class=""> </span><span class="styles_operator__ty4_w">+=</span><span class=""> nestedParts</span><span class="">[</span><span class="">index</span><span class="">]</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      binds</span><span class="">.</span><span class="styles_function__1eRN9">push</span><span class="">(</span><span class="styles_operator__ty4_w">...</span><span class="">bindBinds</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">    </span><span class="">}</span><span class=""> </span><span class="styles_keyword__RcxoL">else</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      parts</span><span class="">.</span><span class="styles_function__1eRN9">push</span><span class="">(</span><span class="">nestedParts</span><span class="">[</span><span class="">index</span><span class="">]</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      binds</span><span class="">.</span><span class="styles_function__1eRN9">push</span><span class="">(</span><span class="">bind</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">    </span><span class="">}</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  </span><span class="">}</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="">[</span><span class="">parts</span><span class="">,</span><span class=""> binds</span><span class="">]</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class=""></span><span class="">}</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">
</span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_keyword__RcxoL">const</span><span class=""> </span><span class=" styles_function__1eRN9">makeQuery</span><span class=""> </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="">execute</span><span class=""> </span><span class="styles_operator__ty4_w">=&gt;</span><span class=""> </span><span class="styles_keyword__RcxoL">function</span><span class=""> </span><span class="styles_function__1eRN9">query</span><span class="">(</span><span class="">inParts</span><span class=" ">,</span><span class=""> </span><span class=" styles_operator__ty4_w">...</span><span class="">inBinds</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  </span><span class="styles_keyword__RcxoL">const</span><span class=""> </span><span class="">[</span><span class="">parts</span><span class="">,</span><span class=""> binds</span><span class="">]</span><span class=""> </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="styles_function__1eRN9">unnest</span><span class="">(</span><span class="">inParts</span><span class="">,</span><span class=""> inBinds</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">  </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="">{</span></div></div></div></section><section id="Async%20Iteration"><h2>Async Iteration</h2><p>One final feature I wanted to add as a performance optimization was async iteration. When I was developing this tool, I was loading a lot of data from the database during jobs, but only needed one record at a time.</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_ styles_highlit__JjWSK"><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="styles_keyword__RcxoL">async</span><span class=""> </span><span class="styles_keyword__RcxoL">function</span><span class=""> </span><span class="styles_function__1eRN9">collect</span><span class="">(</span><span class="">iterator</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  </span><span class="styles_keyword__RcxoL">const</span><span class=""> result </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="">[</span><span class="">]</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  </span><span class="styles_keyword__RcxoL">for</span><span class=""> </span><span class="styles_keyword__RcxoL">await</span><span class=""> </span><span class="">(</span><span class="styles_keyword__RcxoL">const</span><span class=""> item </span><span class="styles_keyword__RcxoL">of</span><span class=""> iterator</span><span class="">)</span><span class=""> result</span><span class="">.</span><span class="styles_function__1eRN9">push</span><span class="">(</span><span class="">item</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  </span><span class="styles_keyword__RcxoL">return</span><span class=""> result</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class=""></span><span class="">}</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">
</span></div><div class="styles_line__aOS_T "><span class=""></span><span class="styles_keyword__RcxoL">const</span><span class=""> </span><span class=" styles_function__1eRN9">makeQuery</span><span class=""> </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="">execute</span><span class=""> </span><span class="styles_operator__ty4_w">=&gt;</span><span class=""> </span><span class="styles_keyword__RcxoL">function</span><span class=""> </span><span class="styles_function__1eRN9">query</span><span class="">(</span><span class="">parts</span><span class=" ">,</span><span class=""> </span><span class=" styles_operator__ty4_w">...</span><span class="">binds</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">  </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">    </span><span class="">[</span><span class="">toQuery</span><span class="">]</span><span class="">(</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">      </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="">[</span><span class="">parts</span><span class="">,</span><span class=""> binds</span><span class="">]</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">    </span><span class="">}</span><span class="">,</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">    </span><span class="styles_function__1eRN9">then</span><span class="">(</span><span class=" styles_operator__ty4_w">...</span><span class="">args</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="styles_function__1eRN9">collect</span><span class="">(</span><span class="styles_keyword__RcxoL">this</span><span class="">)</span><span class="">.</span><span class="styles_function__1eRN9">then</span><span class="">(</span><span class="styles_operator__ty4_w">...</span><span class="">args</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">    </span><span class="">}</span><span class="">,</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">    </span><span class="">[</span><span class="">Symbol</span><span class="">.</span><span class="">asyncIterator</span><span class="">]</span><span class="">(</span><span class="">)</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">      </span><span class="styles_keyword__RcxoL">return</span><span class=""> </span><span class="styles_function__1eRN9">execute</span><span class="">(</span><span class="">parts</span><span class="">,</span><span class=""> binds</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">    </span><span class="">}</span><span class="">,</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">  </span><span class="">}</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="">}</span></div></div></div><p>This also requires a change to the execute function as well, which will depend greatly on the database library.</p><div class="styles_p__HqdKC"><div class="styles_container__jy1l_ styles_highlit__JjWSK"><div class="styles_line__aOS_T "><span class="styles_keyword__RcxoL">const</span><span class=""> $ </span><span class="styles_operator__ty4_w">=</span><span class=""> </span><span class="styles_function__1eRN9">makeQuery</span><span class="">(</span><span class="">(</span><span class="">parts</span><span class=" ">,</span><span class=""> binds</span><span class="">)</span><span class=""> </span><span class="styles_operator__ty4_w">=&gt;</span><span class=""> </span><span class="">{</span><span class=""></span></div><div class="styles_line__aOS_T "><span class="">  </span><span class="styles_keyword__RcxoL">const</span><span class=""> result </span><span class="styles_operator__ty4_w">=</span><span class=""> connection</span><span class="">.</span><span class="styles_function__1eRN9">execute</span><span class="">(</span><span class="">{</span><span class=""> </span><span class=" styles_property__BaBI9">sql</span><span class="styles_operator__ty4_w">:</span><span class=""> parts</span><span class="">.</span><span class="styles_function__1eRN9">join</span><span class="">(</span><span class="styles_string__bCSta">&quot;$&quot;</span><span class="">)</span><span class="">,</span><span class=""> binds </span><span class="">}</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T styles_highlight__lqo_T"><span class="">  </span><span class="styles_keyword__RcxoL">return</span><span class=""> result</span><span class="">.</span><span class="styles_function__1eRN9">streamRows</span><span class="">(</span><span class="">)</span><span class="">;</span><span class=""></span></div><div class="styles_line__aOS_T "><span class=""></span><span class="">}</span><span class="">)</span></div></div></div></section><section id="Conclusion"><h2>Conclusion</h2><p>This tool can be a great help for certain scenarios, particularly those that are using complex SQL queries, probably doing some kind of data analysis. But for more typical transactional workflows, query builders or even an ORM can better suited to the task.</p><h3>Further Reading:</h3><ul><li><a href="https://github.com/spencerschack/spencerschack.github.io/blob/next/src/app/query/query.ts">query.ts</a>: The full, Typescript version of this tool.</li><li><a href="https://martinfowler.com/bliki/MinimalInterface.html">MinimalInterface</a>: What is a “minimal interface” and why it might be better than a “humane interface”.</li><li><a href="https://github.com/blakeembrey/sql-template-tag">sql-template-tag</a>: Another implementation without some features (<code>then</code>able result, async iteration). Database agnostic, but supports<!-- --> <code>pg</code> and <code>mysql</code> out of the box.</li><li><a href="https://github.com/andywer/squid">squid</a>: Similar features to <code>sql-template-tag</code>, but supports static query validations via <code>postguard</code>. Only supports Postgres.</li></ul></section></div></div></div><script src="/_next/static/chunks/webpack-b4a7d43db020ffb5.js" async=""></script><script src="/_next/static/chunks/2443530c-824e93370d7398c3.js" async=""></script><script src="/_next/static/chunks/488-e1ddd61bb847c097.js" async=""></script><script src="/_next/static/chunks/main-app-30b5c4246e6fba4e.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/035951aefad7b653-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/3478b6abef19b3b3-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/media/d50fa1c781f60195-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/8dc07470c12386b5.css\",{\"as\":\"style\"}]\n0:\"$L5\"\n"])</script><script>self.__next_f.push([1,"6:HL[\"/_next/static/css/3457e45db263924b.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"7:I{\"id\":\"8827\",\"chunks\":[\"272:static/chunks/webpack-b4a7d43db020ffb5.js\",\"667:static/chunks/2443530c-824e93370d7398c3.js\",\"488:static/chunks/488-e1ddd61bb847c097.js\"],\"name\":\"\",\"async\":false}\n9:I{\"id\":\"9126\",\"chunks\":[\"272:static/chunks/webpack-b4a7d43db020ffb5.js\",\"667:static/chunks/2443530c-824e93370d7398c3.js\",\"488:static/chunks/488-e1ddd61bb847c097.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":\"4463\",\"chunks\":[\"272:static/chunks/webpack-b4a7d43db020ffb5.js\",\"667:static/chunks/2443530c-824e93370d7398c3.js\",\"48"])</script><script>self.__next_f.push([1,"8:static/chunks/488-e1ddd61bb847c097.js\"],\"name\":\"\",\"async\":false}\nc:I{\"id\":\"1010\",\"chunks\":[\"272:static/chunks/webpack-b4a7d43db020ffb5.js\",\"667:static/chunks/2443530c-824e93370d7398c3.js\",\"488:static/chunks/488-e1ddd61bb847c097.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"5:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/8dc07470c12386b5.css\",\"precedence\":\"next\"}]],[\"$\",\"$L7\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/query\",\"initialTree\":[\"\",{\"children\":[\"query\",{\"children\":[\"__PAGE__\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$L8\",[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]],\"globalErrorComponent\":\"$9\",\"notFound\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_f30994 __className_8fb110\",\"children\":[\"$La\",\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}]}],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_f30994 __className_8fb110\",\"children\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"query\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Ld\",null],\"segment\":\"__PAGE__\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3457e45db263924b.css\",\"precedence\":\"next\"}]]}],\"segment\":\"query\"},\"styles\":[]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"e:I{\"id\":\"7606\",\"chunks\":[\"391:static/chunks/391-b35b0c09989558eb.js\",\"25:static/chunks/app/query/page-54776bf5585cfbb2.js\"],\"name\":\"\",\"async\":false}\nf:I{\"id\":\"5623\",\"chunks\":[\"391:static/chunks/391-b35b0c09989558eb.js\",\"25:static/chunks/app/query/page-54776bf5585cfbb2.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"d:[\"$\",\"div\",null,{\"className\":\"styles_root__FGv06\",\"children\":[[\"$\",\"$Le\",null,{\"initialResults\":{\"columns\":[\"name\",\"avg_revenue\",\"max_revenue\",\"avg_sales\",\"max_sales\"],\"values\":[[\"Bacon\",6160,15640,4,6],[\"Ball\",4902,8564,4,6],[\"Car\",3231,8506,2,5],[\"Chair\",1962,4550,4,8],[\"Chicken\",3960,7618,4,5],[\"Computer\",4689,9466,4,6],[\"Fish\",1672,2926,1,2],[\"Gloves\",3088,5018,3,3],[\"Mouse\",4283,10020,4,9],[\"Pizza\",3819,6820,2,2],[\"Salad\",127,320,1,2],[\"Tuna\",8808,14055,3,6]]},\"initialCode\":\"const orders = interval =\u003e $`\\n  SELECT name, SUM(quantity * price) AS revenue, COUNT(*) AS sales\\n  FROM products JOIN orders USING (product_id)\\n  GROUP BY name, STRFTIME(${interval}, date)\\n`;\\nconst stats = column =\u003e $`\\n  ROUND(AVG(${column})) AS avg_${column},\\n  MAX(${column}) AS max_${column}\\n`;\\nreturn $`\\n  SELECT name, ${stats($`revenue`)}, ${stats($`sales`)}\\n  FROM (${orders('%Y')})\\n  GROUP BY name\\n`;\"}],[\"$\",\"div\",null,{\"className\":\"styles_container__b_OzL\",\"children\":[[\"$\",\"ol\",null,{\"className\":\"styles_toc__bIATy\",\"children\":[\"$\",\"$Lf\",null,{\"titles\":[\"Demo\",\"Introduction\",\"Motivation\",\"Experimentation\",\"Implementation\",\"Query Composition\",\"Async Iteration\",\"Conclusion\"]}]}],[\"$\",\"div\",null,{\"className\":\"styles_content__hvl__\",\"children\":[[\"$\",\"section\",null,{\"id\":\"Introduction\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],[\"$\",\"p\",null,{\"children\":\"A better API is sometimes the one with fewer features. Often the development effort of software is dominated by the long tail of features. You can get 80% of the features for 20% of the work...if you can do without every last feature.\"}],[\"$\",\"p\",null,{\"children\":[\"Writing SQL queries is often an inevitable part of software development. SQL is either written by hand or with the help of query builders. Query builders, such as\",\" \",[\"$\",\"a\",null,{\"href\":\"https://guides.rubyonrails.org/active_record_basics.html\",\"children\":\"ActiveRecord\"}],\" \",\"or \",[\"$\",\"a\",null,{\"href\":\"https://knexjs.org/guide/query-builder.html#knex\",\"children\":\"Knex\"}],\", are tools that help to create queries through an API native to the programming language you're executing the queries from.\"]}]]}],[\"$\",\"section\",null,{\"id\":\"Motivation\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Motivation\"}],[\"$\",\"p\",null,{\"children\":\"Query builders can be very useful when writing simple queries:\"}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_function__1eRN9\",\"children\":\"knex\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_string__bCSta\",\"children\":\"'posts'\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"5\",{\"className\":\"styles_function__1eRN9\",\"children\":\"where\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"7\",{\"className\":\"styles_string__bCSta\",\"children\":\"'category_id'\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"10\",{\"className\":\"styles_number__dhAtQ\",\"children\":\"42\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"13\",{\"className\":\"styles_function__1eRN9\",\"children\":\"orderBy\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"15\",{\"className\":\"styles_string__bCSta\",\"children\":\"'created_at'\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\";\"}]]}]]}]}],[\"$\",\"p\",null,{\"children\":\"However, this approach does have some downsides:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Every query feature in your target database needs a corresponding query builder API. The effort to develop, maintain, and learn how to use the query builder is coupled with how many features you want to use.\"}],[\"$\",\"li\",null,{\"children\":\"SQL is a standardized, widely-used language that enables developers to share their ability to query databases across projects and teams. The benefits of the widespread familiarity with SQL is lost when each query builder has a unique API.\"}]]}]]}],[\"$\",\"section\",null,{\"id\":\"Experimentation\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Experimentation\"}],[\"$\",\"p\",null,{\"children\":\"Writing queries by hand with strings and variable interpolation is not the answer either because of the need to mitigate SQL injestion and correctly serialize the variables.\"}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_comment__UauEA\",\"children\":\"// This is susceptible to SQL injection and wouldn't\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"1\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_comment__UauEA\",\"children\":\"// correctly interpolate string literals.\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"2\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"connection\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"execute\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"5\",{\"className\":\" styles_string__bCSta\",\"children\":\"SELECT * FROM users WHERE id = \"}],[\"$\",\"span\",\"6\",{\"className\":\"   \",\"children\":\"$${\"}],[\"$\",\"span\",\"7\",{\"className\":\" \",\"children\":\"id\"}],[\"$\",\"span\",\"8\",{\"className\":\"   \",\"children\":\"}\"}],[\"$\",\"span\",\"9\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\";\"}]]}]]}]}],[\"$\",\"p\",null,{\"children\":\"Javascript does have a language feature that helps these solves issues. Tagged template literals:\"}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"query\"}],[\"$\",\"span\",\"1\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"2\",{\"className\":\" styles_string__bCSta\",\"children\":\"SELECT * FROM users WHERE id = \"}],[\"$\",\"span\",\"3\",{\"className\":\"   \",\"children\":\"$${\"}],[\"$\",\"span\",\"4\",{\"className\":\" \",\"children\":\"id\"}],[\"$\",\"span\",\"5\",{\"className\":\"   \",\"children\":\"}\"}],[\"$\",\"span\",\"6\",{\"className\":\" styles_string__bCSta\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"1\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_comment__UauEA\",\"children\":\"// is equivalent to\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"2\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_function__1eRN9\",\"children\":\"query\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_string__bCSta\",\"children\":\"\\\"SELECT * FROM users WHERE id = \\\"\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"styles_string__bCSta\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\"id\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\";\"}]]}]]}]}],[\"$\",\"p\",null,{\"children\":\"I wanted to create an interface for writing SQL to work like it was part of the source code instead of just a string parameter. Similar to JSX where building html elements is baked into the language for better ergonomics. The end goal was something like this:\"}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"result\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"6\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"8\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"await\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\" query\"}],[\"$\",\"span\",\"10\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"11\",{\"className\":\" styles_string__bCSta\",\"children\":\"SELECT * FROM users WHERE id = \"}],[\"$\",\"span\",\"12\",{\"className\":\"   \",\"children\":\"$${\"}],[\"$\",\"span\",\"13\",{\"className\":\" \",\"children\":\"id\"}],[\"$\",\"span\",\"14\",{\"className\":\"   \",\"children\":\"}\"}],[\"$\",\"span\",\"15\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\";\"}]]}]]}]}]]}],[\"$\",\"section\",null,{\"id\":\"Implementation\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Implementation\"}],[\"$\",\"p\",null,{\"children\":[\"My first step was creating something like\",\" \",[\"$\",\"a\",null,{\"href\":\"https://github.com/blakeembrey/sql-template-tag\",\"children\":\"sql-template-tag\"}],\" \",\"using\",\" \",[\"$\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates\",\"children\":\"tagged template literals\"}],\". This single line function already completed about 80% of the API.\"]}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"function\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"query\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"5\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"binds\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"1\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" connection\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_function__1eRN9\",\"children\":\"execute\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"8\",{\"className\":\" styles_property__BaBI9\",\"children\":\"sql\"}],[\"$\",\"span\",\"9\",{\"className\":\"styles_operator__ty4_w\",\"children\":\":\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" parts\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"12\",{\"className\":\"styles_function__1eRN9\",\"children\":\"join\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"14\",{\"className\":\"styles_string__bCSta\",\"children\":\"\\\"$\\\"\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\" binds \"}],[\"$\",\"span\",\"18\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"19\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"20\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"21\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"2\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"3\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\\n\"}]]}],[\"$\",\"div\",\"4\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"result\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"9\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"await\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" query\"}],[\"$\",\"span\",\"11\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"12\",{\"className\":\" styles_string__bCSta\",\"children\":\"SELECT * FROM users WHERE id = \"}],[\"$\",\"span\",\"13\",{\"className\":\"   \",\"children\":\"$${\"}],[\"$\",\"span\",\"14\",{\"className\":\" \",\"children\":\"id\"}],[\"$\",\"span\",\"15\",{\"className\":\"   \",\"children\":\"}\"}],[\"$\",\"span\",\"16\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\";\"}]]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"The first thing I needed to fix was that a query would execute immediately, right when it was defined. It would be better if it would run only when \",[\"$\",\"code\",null,{\"children\":\"await\"}],\"ed. This can be accomplished with \\\"lazy\\\" promises by creating an object with a \",[\"$\",\"code\",null,{\"children\":\"then\"}],\" \",\"method.\"]}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_ styles_highlit__JjWSK\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"function\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"query\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"5\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"binds\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"1\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"2\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_function__1eRN9\",\"children\":\"then\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"3\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"args\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"3\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" connection\"}]]}],[\"$\",\"div\",\"4\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"        \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"execute\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"6\",{\"className\":\" styles_property__BaBI9\",\"children\":\"sql\"}],[\"$\",\"span\",\"7\",{\"className\":\"styles_operator__ty4_w\",\"children\":\":\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" parts\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"10\",{\"className\":\"styles_function__1eRN9\",\"children\":\"join\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"12\",{\"className\":\"styles_string__bCSta\",\"children\":\"\\\"$\\\"\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\" binds \"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"18\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"5\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"        \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"then\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"args\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"6\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}]]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"I wanted this tool to be database agnostic so I extracted the execution logic and renamed the helper to \",[\"$\",\"code\",null,{\"children\":\"$$\"}],\" to be more succinct:\"]}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_ styles_highlit__JjWSK\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"2\",{\"className\":\" styles_function__1eRN9\",\"children\":\"makeQuery\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"execute\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"8\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\u003e\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"10\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"function\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"12\",{\"className\":\"styles_function__1eRN9\",\"children\":\"query\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"15\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"17\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"18\",{\"className\":\"\",\"children\":\"binds\"}],[\"$\",\"span\",\"19\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"20\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"21\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"22\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"1\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"2\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_function__1eRN9\",\"children\":\"then\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"3\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"args\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"3\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_function__1eRN9\",\"children\":\"execute\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\" binds\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"10\",{\"className\":\"styles_function__1eRN9\",\"children\":\"then\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"12\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\"args\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"4\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"5\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"6\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"7\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\\n\"}]]}],[\"$\",\"div\",\"8\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" $ \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"5\",{\"className\":\"styles_function__1eRN9\",\"children\":\"makeQuery\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"9\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" binds\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"13\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\u003e\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"9\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  connection\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"execute\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"6\",{\"className\":\" styles_property__BaBI9\",\"children\":\"sql\"}],[\"$\",\"span\",\"7\",{\"className\":\"styles_operator__ty4_w\",\"children\":\":\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" parts\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"10\",{\"className\":\"styles_function__1eRN9\",\"children\":\"join\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"12\",{\"className\":\"styles_string__bCSta\",\"children\":\"\\\"$\\\"\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\" binds \"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"18\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"19\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"10\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\")\"}]]}]]}]}]]}],[\"$\",\"section\",null,{\"id\":\"Query%20Composition\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Query Composition\"}],[\"$\",\"p\",null,{\"children\":\"There was a key feature that was missing: query composition. So far, the helper supported interpolating variables, but not other subqueries themselves.\"}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_comment__UauEA\",\"children\":\"// Not (yet) supported\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"1\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" lastDay \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" query\"}],[\"$\",\"span\",\"5\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"6\",{\"className\":\" styles_string__bCSta\",\"children\":\"created_at \u003e current_timestamp() - interval '1' day\"}],[\"$\",\"span\",\"7\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"2\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" results \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"5\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"await\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" query\"}],[\"$\",\"span\",\"7\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"8\",{\"className\":\" styles_string__bCSta\",\"children\":\"SELECT * FROM ads WHERE \"}],[\"$\",\"span\",\"9\",{\"className\":\"   \",\"children\":\"$${\"}],[\"$\",\"span\",\"10\",{\"className\":\" \",\"children\":\"lastDay\"}],[\"$\",\"span\",\"11\",{\"className\":\"   \",\"children\":\"}\"}],[\"$\",\"span\",\"12\",{\"className\":\"  styles_string__bCSta\",\"children\":\"`\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\";\"}]]}]]}]}],[\"$\",\"p\",null,{\"children\":\"Nested queries were more difficult to support. There were two things that needed to be done to support them: determine a nested query from a variable bind and unnesting the nested queries.\"}],[\"$\",\"p\",null,{\"children\":[\"We can determine a query from other types with a Javascript idiom where we use a \",[\"$\",\"code\",null,{\"children\":\"Symbol\"}],\" to allow conversion of a value into another type. This pattern is used by Javascript to implement iteration via\",\" \",[\"$\",\"code\",null,{\"children\":\"Symbol.iterator\"}],\".\"]}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_ styles_highlit__JjWSK\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\" toQuery \"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"new\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"Symbol\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"1\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\\n\"}]]}],[\"$\",\"div\",\"2\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\" styles_function__1eRN9\",\"children\":\"makeQuery\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"5\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"execute\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"9\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\u003e\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"11\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"function\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"13\",{\"className\":\"styles_function__1eRN9\",\"children\":\"query\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"16\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"18\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"19\",{\"className\":\"\",\"children\":\"binds\"}],[\"$\",\"span\",\"20\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"21\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"22\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"23\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"3\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"4\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"toQuery\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"5\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" binds\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"6\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"7\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_function__1eRN9\",\"children\":\"then\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"3\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"args\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"{\"}]]}]]}]}],[\"$\",\"p\",null,{\"children\":\"To unnest the nested query, we have to iterate over the static parts of the query and the binds. In addition to flattening the top level and nested parts and binds, the first and last parts of each nested query must be concatenated to the surrounding parts in the top level query.\"}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_ styles_highlit__JjWSK\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\" toQuery \"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"new\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"Symbol\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"1\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\\n\"}]]}],[\"$\",\"div\",\"2\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"function\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_function__1eRN9\",\"children\":\"unnest\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"5\",{\"className\":\" \",\"children\":\"[\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"firstPart\"}],[\"$\",\"span\",\"7\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"9\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\"nestedParts\"}],[\"$\",\"span\",\"11\",{\"className\":\" \",\"children\":\"]\"}],[\"$\",\"span\",\"12\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\" nestedBinds\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"3\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" parts \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"firstPart\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"4\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" binds \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"5\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  nestedBinds\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"forEach\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"bind\"}],[\"$\",\"span\",\"6\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\" index\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"10\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\u003e\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"6\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"if\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"bind \"}],[\"$\",\"span\",\"5\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"\u0026\u0026\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"typeof\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" bind \"}],[\"$\",\"span\",\"9\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"===\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"11\",{\"className\":\"styles_string__bCSta\",\"children\":\"\\\"object\\\"\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"13\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"\u0026\u0026\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\" toQuery \"}],[\"$\",\"span\",\"15\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"in\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\" bind\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"18\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"19\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"20\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"7\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"bindParts\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" bindBinds\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"9\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" bind\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\"toQuery\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"8\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      parts\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"length \"}],[\"$\",\"span\",\"5\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"-\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"styles_number__dhAtQ\",\"children\":\"1\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"10\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"+=\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\" bindParts\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"13\",{\"className\":\"styles_number__dhAtQ\",\"children\":\"0\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"9\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      parts\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"push\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"bindParts\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"7\",{\"className\":\"styles_function__1eRN9\",\"children\":\"slice\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"9\",{\"className\":\"styles_number__dhAtQ\",\"children\":\"1\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"10\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      parts\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"length \"}],[\"$\",\"span\",\"5\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"-\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"styles_number__dhAtQ\",\"children\":\"1\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"10\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"+=\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\" nestedParts\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\"index\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"11\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      binds\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"push\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"bindBinds\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"12\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"else\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"13\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      parts\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"push\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"nestedParts\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"index\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"14\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      binds\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_function__1eRN9\",\"children\":\"push\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"bind\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"15\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"16\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"17\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" binds\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"18\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"19\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\\n\"}]]}],[\"$\",\"div\",\"20\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\" styles_function__1eRN9\",\"children\":\"makeQuery\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"5\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"execute\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"9\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\u003e\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"11\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"function\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"13\",{\"className\":\"styles_function__1eRN9\",\"children\":\"query\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\"inParts\"}],[\"$\",\"span\",\"16\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"18\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"19\",{\"className\":\"\",\"children\":\"inBinds\"}],[\"$\",\"span\",\"20\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"21\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"22\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"23\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"21\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" binds\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"9\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"11\",{\"className\":\"styles_function__1eRN9\",\"children\":\"unnest\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\"inParts\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\" inBinds\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"18\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"22\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"{\"}]]}]]}]}]]}],[\"$\",\"section\",null,{\"id\":\"Async%20Iteration\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Async Iteration\"}],[\"$\",\"p\",null,{\"children\":\"One final feature I wanted to add as a performance optimization was async iteration. When I was developing this tool, I was loading a lot of data from the database during jobs, but only needed one record at a time.\"}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_ styles_highlit__JjWSK\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"async\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"function\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_function__1eRN9\",\"children\":\"collect\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"iterator\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"1\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" result \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"2\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"for\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"await\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"6\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\" item \"}],[\"$\",\"span\",\"8\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"of\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\" iterator\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\" result\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"13\",{\"className\":\"styles_function__1eRN9\",\"children\":\"push\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\"item\"}],[\"$\",\"span\",\"16\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"18\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"3\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" result\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"4\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"5\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\\n\"}]]}],[\"$\",\"div\",\"6\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\" styles_function__1eRN9\",\"children\":\"makeQuery\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"5\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"execute\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"9\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\u003e\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"11\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"function\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"13\",{\"className\":\"styles_function__1eRN9\",\"children\":\"query\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"16\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"18\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"19\",{\"className\":\"\",\"children\":\"binds\"}],[\"$\",\"span\",\"20\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"21\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"22\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"23\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"7\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"8\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"toQuery\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"9\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" binds\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"10\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"11\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_function__1eRN9\",\"children\":\"then\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"3\",{\"className\":\" styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"args\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"12\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_function__1eRN9\",\"children\":\"collect\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"5\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"this\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"8\",{\"className\":\"styles_function__1eRN9\",\"children\":\"then\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"10\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"...\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\"args\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"13\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"14\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"[\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"Symbol\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"asyncIterator\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"]\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"15\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"      \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_function__1eRN9\",\"children\":\"execute\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\" binds\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"16\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"    \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"17\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"18\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}]]}]]}]}],[\"$\",\"p\",null,{\"children\":\"This also requires a change to the execute function as well, which will depend greatly on the database library.\"}],[\"$\",\"div\",null,{\"className\":\"styles_p__HqdKC\",\"children\":[\"$\",\"div\",null,{\"className\":\"styles_container__jy1l_ styles_highlit__JjWSK\",\"children\":[[\"$\",\"div\",\"0\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\" $ \"}],[\"$\",\"span\",\"2\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_function__1eRN9\",\"children\":\"makeQuery\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"parts\"}],[\"$\",\"span\",\"8\",{\"className\":\" \",\"children\":\",\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\" binds\"}],[\"$\",\"span\",\"10\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"11\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"12\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\u003e\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"14\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"1\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"const\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" result \"}],[\"$\",\"span\",\"3\",{\"className\":\"styles_operator__ty4_w\",\"children\":\"=\"}],[\"$\",\"span\",\"4\",{\"className\":\"\",\"children\":\" connection\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"6\",{\"className\":\"styles_function__1eRN9\",\"children\":\"execute\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"{\"}],[\"$\",\"span\",\"9\",{\"className\":\"\",\"children\":\" \"}],[\"$\",\"span\",\"10\",{\"className\":\" styles_property__BaBI9\",\"children\":\"sql\"}],[\"$\",\"span\",\"11\",{\"className\":\"styles_operator__ty4_w\",\"children\":\":\"}],[\"$\",\"span\",\"12\",{\"className\":\"\",\"children\":\" parts\"}],[\"$\",\"span\",\"13\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"14\",{\"className\":\"styles_function__1eRN9\",\"children\":\"join\"}],[\"$\",\"span\",\"15\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"16\",{\"className\":\"styles_string__bCSta\",\"children\":\"\\\"$\\\"\"}],[\"$\",\"span\",\"17\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"18\",{\"className\":\"\",\"children\":\",\"}],[\"$\",\"span\",\"19\",{\"className\":\"\",\"children\":\" binds \"}],[\"$\",\"span\",\"20\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"21\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"22\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"23\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"2\",{\"className\":\"styles_line__aOS_T styles_highlight__lqo_T\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"  \"}],[\"$\",\"span\",\"1\",{\"className\":\"styles_keyword__RcxoL\",\"children\":\"return\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\" result\"}],[\"$\",\"span\",\"3\",{\"className\":\"\",\"children\":\".\"}],[\"$\",\"span\",\"4\",{\"className\":\"styles_function__1eRN9\",\"children\":\"streamRows\"}],[\"$\",\"span\",\"5\",{\"className\":\"\",\"children\":\"(\"}],[\"$\",\"span\",\"6\",{\"className\":\"\",\"children\":\")\"}],[\"$\",\"span\",\"7\",{\"className\":\"\",\"children\":\";\"}],[\"$\",\"span\",\"8\",{\"className\":\"\",\"children\":\"\"}]]}],[\"$\",\"div\",\"3\",{\"className\":\"styles_line__aOS_T \",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"\",\"children\":\"\"}],[\"$\",\"span\",\"1\",{\"className\":\"\",\"children\":\"}\"}],[\"$\",\"span\",\"2\",{\"className\":\"\",\"children\":\")\"}]]}]]}]}]]}],[\"$\",\"section\",null,{\"id\":\"Conclusion\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Conclusion\"}],[\"$\",\"p\",null,{\"children\":\"This tool can be a great help for certain scenarios, particularly those that are using complex SQL queries, probably doing some kind of data analysis. But for more typical transactional workflows, query builders or even an ORM can better suited to the task.\"}],[\"$\",\"h3\",null,{\"children\":\"Further Reading:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://github.com/spencerschack/spencerschack.github.io/blob/next/src/app/query/query.ts\",\"children\":\"query.ts\"}],\": The full, Typescript version of this tool.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://martinfowler.com/bliki/MinimalInterface.html\",\"children\":\"MinimalInterface\"}],\": What is a “minimal interface” and why it might be better than a “humane interface”.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://github.com/blakeembrey/sql-template-tag\",\"children\":\"sql-template-tag\"}],\": Another implementation without some features (\",[\"$\",\"code\",null,{\"children\":\"then\"}],\"able result, async iteration). Database agnostic, but supports\",\" \",[\"$\",\"code\",null,{\"children\":\"pg\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"mysql\"}],\" out of the box.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://github.com/andywer/squid\",\"children\":\"squid\"}],\": Similar features to \",[\"$\",\"code\",null,{\"children\":\"sql-template-tag\"}],\", but supports static query validations via \",[\"$\",\"code\",null,{\"children\":\"postguard\"}],\". Only supports Postgres.\"]}]]}]]}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"a:[[[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}],null,null,null,null,null,null,null,null,null,null,[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,null]\n8:[[[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}],[\"$\",\"title\",null,{\"children\":\"spencerschack.com\"}],null,null,null,null,null,null,null,null,null,[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=dev"])</script><script>self.__next_f.push([1,"ice-width, initial-scale=1\"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}]],[],null]]\n"])</script></body></html>
1:HL["/_next/static/media/035951aefad7b653-s.p.woff2",{"as":"font","type":"font/woff2"}]
2:HL["/_next/static/media/3478b6abef19b3b3-s.p.woff2",{"as":"font","type":"font/woff2"}]
3:HL["/_next/static/media/d50fa1c781f60195-s.p.woff2",{"as":"font","type":"font/woff2"}]
4:HL["/_next/static/css/8dc07470c12386b5.css",{"as":"style"}]
0:[[["",{"children":["query",{"children":["__PAGE__",{}]}]},"$undefined","$undefined",true],"$L5",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/8dc07470c12386b5.css","precedence":"next"}]],["$L6",["$","meta",null,{"name":"next-size-adjust"}]]]]]
7:HL["/_next/static/css/3457e45db263924b.css",{"as":"style"}]
8:I{"id":"4463","chunks":["272:static/chunks/webpack-b4a7d43db020ffb5.js","667:static/chunks/2443530c-824e93370d7398c3.js","488:static/chunks/488-e1ddd61bb847c097.js"],"name":"","async":false}
9:I{"id":"1010","chunks":["272:static/chunks/webpack-b4a7d43db020ffb5.js","667:static/chunks/2443530c-824e93370d7398c3.js","488:static/chunks/488-e1ddd61bb847c097.js"],"name":"","async":false}
5:[["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__variable_f30994 __className_8fb110","children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","query","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$La",null],"segment":"__PAGE__"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/3457e45db263924b.css","precedence":"next"}]]}],"segment":"query"},"styles":[]}]}]}],null]
6:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"spencerschack.com"}],null,null,null,null,null,null,null,null,null,["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]],[],null]]
b:I{"id":"7606","chunks":["391:static/chunks/391-b35b0c09989558eb.js","25:static/chunks/app/query/page-54776bf5585cfbb2.js"],"name":"","async":false}
c:I{"id":"5623","chunks":["391:static/chunks/391-b35b0c09989558eb.js","25:static/chunks/app/query/page-54776bf5585cfbb2.js"],"name":"","async":false}
a:["$","div",null,{"className":"styles_root__FGv06","children":[["$","$Lb",null,{"initialResults":{"columns":["name","avg_revenue","max_revenue","avg_sales","max_sales"],"values":[["Bacon",6160,15640,4,6],["Ball",4902,8564,4,6],["Car",3231,8506,2,5],["Chair",1962,4550,4,8],["Chicken",3960,7618,4,5],["Computer",4689,9466,4,6],["Fish",1672,2926,1,2],["Gloves",3088,5018,3,3],["Mouse",4283,10020,4,9],["Pizza",3819,6820,2,2],["Salad",127,320,1,2],["Tuna",8808,14055,3,6]]},"initialCode":"const orders = interval => $`\n  SELECT name, SUM(quantity * price) AS revenue, COUNT(*) AS sales\n  FROM products JOIN orders USING (product_id)\n  GROUP BY name, STRFTIME(${interval}, date)\n`;\nconst stats = column => $`\n  ROUND(AVG(${column})) AS avg_${column},\n  MAX(${column}) AS max_${column}\n`;\nreturn $`\n  SELECT name, ${stats($`revenue`)}, ${stats($`sales`)}\n  FROM (${orders('%Y')})\n  GROUP BY name\n`;"}],["$","div",null,{"className":"styles_container__b_OzL","children":[["$","ol",null,{"className":"styles_toc__bIATy","children":["$","$Lc",null,{"titles":["Demo","Introduction","Motivation","Experimentation","Implementation","Query Composition","Async Iteration","Conclusion"]}]}],["$","div",null,{"className":"styles_content__hvl__","children":[["$","section",null,{"id":"Introduction","children":[["$","h2",null,{"children":"Introduction"}],["$","p",null,{"children":"A better API is sometimes the one with fewer features. Often the development effort of software is dominated by the long tail of features. You can get 80% of the features for 20% of the work...if you can do without every last feature."}],["$","p",null,{"children":["Writing SQL queries is often an inevitable part of software development. SQL is either written by hand or with the help of query builders. Query builders, such as"," ",["$","a",null,{"href":"https://guides.rubyonrails.org/active_record_basics.html","children":"ActiveRecord"}]," ","or ",["$","a",null,{"href":"https://knexjs.org/guide/query-builder.html#knex","children":"Knex"}],", are tools that help to create queries through an API native to the programming language you're executing the queries from."]}]]}],["$","section",null,{"id":"Motivation","children":[["$","h2",null,{"children":"Motivation"}],["$","p",null,{"children":"Query builders can be very useful when writing simple queries:"}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_function__1eRN9","children":"knex"}],["$","span","1",{"className":"","children":"("}],["$","span","2",{"className":"styles_string__bCSta","children":"'posts'"}],["$","span","3",{"className":"","children":")"}],["$","span","4",{"className":"","children":"."}],["$","span","5",{"className":"styles_function__1eRN9","children":"where"}],["$","span","6",{"className":"","children":"("}],["$","span","7",{"className":"styles_string__bCSta","children":"'category_id'"}],["$","span","8",{"className":"","children":","}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":"styles_number__dhAtQ","children":"42"}],["$","span","11",{"className":"","children":")"}],["$","span","12",{"className":"","children":"."}],["$","span","13",{"className":"styles_function__1eRN9","children":"orderBy"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"styles_string__bCSta","children":"'created_at'"}],["$","span","16",{"className":"","children":")"}],["$","span","17",{"className":"","children":";"}]]}]]}]}],["$","p",null,{"children":"However, this approach does have some downsides:"}],["$","ul",null,{"children":[["$","li",null,{"children":"Every query feature in your target database needs a corresponding query builder API. The effort to develop, maintain, and learn how to use the query builder is coupled with how many features you want to use."}],["$","li",null,{"children":"SQL is a standardized, widely-used language that enables developers to share their ability to query databases across projects and teams. The benefits of the widespread familiarity with SQL is lost when each query builder has a unique API."}]]}]]}],["$","section",null,{"id":"Experimentation","children":[["$","h2",null,{"children":"Experimentation"}],["$","p",null,{"children":"Writing queries by hand with strings and variable interpolation is not the answer either because of the need to mitigate SQL injestion and correctly serialize the variables."}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_comment__UauEA","children":"// This is susceptible to SQL injection and wouldn't"}],["$","span","1",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_comment__UauEA","children":"// correctly interpolate string literals."}],["$","span","2",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"connection"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"  styles_string__bCSta","children":"`"}],["$","span","5",{"className":" styles_string__bCSta","children":"SELECT * FROM users WHERE id = "}],["$","span","6",{"className":"   ","children":"$${"}],["$","span","7",{"className":" ","children":"id"}],["$","span","8",{"className":"   ","children":"}"}],["$","span","9",{"className":"  styles_string__bCSta","children":"`"}],["$","span","10",{"className":"","children":")"}],["$","span","11",{"className":"","children":";"}]]}]]}]}],["$","p",null,{"children":"Javascript does have a language feature that helps these solves issues. Tagged template literals:"}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"query"}],["$","span","1",{"className":"  styles_string__bCSta","children":"`"}],["$","span","2",{"className":" styles_string__bCSta","children":"SELECT * FROM users WHERE id = "}],["$","span","3",{"className":"   ","children":"$${"}],["$","span","4",{"className":" ","children":"id"}],["$","span","5",{"className":"   ","children":"}"}],["$","span","6",{"className":" styles_string__bCSta","children":" "}],["$","span","7",{"className":"  styles_string__bCSta","children":"`"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_comment__UauEA","children":"// is equivalent to"}],["$","span","2",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_function__1eRN9","children":"query"}],["$","span","2",{"className":"","children":"("}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"styles_string__bCSta","children":"\"SELECT * FROM users WHERE id = \""}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"styles_string__bCSta","children":"\"\""}],["$","span","8",{"className":"","children":"]"}],["$","span","9",{"className":"","children":","}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"","children":"["}],["$","span","12",{"className":"","children":"id"}],["$","span","13",{"className":"","children":"]"}],["$","span","14",{"className":"","children":")"}],["$","span","15",{"className":"","children":";"}]]}]]}]}],["$","p",null,{"children":"I wanted to create an interface for writing SQL to work like it was part of the source code instead of just a string parameter. Similar to JSX where building html elements is baked into the language for better ergonomics. The end goal was something like this:"}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","1",{"className":"","children":" "}],["$","span","2",{"className":"","children":"["}],["$","span","3",{"className":"","children":"result"}],["$","span","4",{"className":"","children":"]"}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":"styles_operator__ty4_w","children":"="}],["$","span","7",{"className":"","children":" "}],["$","span","8",{"className":"styles_keyword__RcxoL","children":"await"}],["$","span","9",{"className":"","children":" query"}],["$","span","10",{"className":"  styles_string__bCSta","children":"`"}],["$","span","11",{"className":" styles_string__bCSta","children":"SELECT * FROM users WHERE id = "}],["$","span","12",{"className":"   ","children":"$${"}],["$","span","13",{"className":" ","children":"id"}],["$","span","14",{"className":"   ","children":"}"}],["$","span","15",{"className":"  styles_string__bCSta","children":"`"}],["$","span","16",{"className":"","children":";"}]]}]]}]}]]}],["$","section",null,{"id":"Implementation","children":[["$","h2",null,{"children":"Implementation"}],["$","p",null,{"children":["My first step was creating something like"," ",["$","a",null,{"href":"https://github.com/blakeembrey/sql-template-tag","children":"sql-template-tag"}]," ","using"," ",["$","a",null,{"href":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates","children":"tagged template literals"}],". This single line function already completed about 80% of the API."]}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","1",{"className":"","children":" "}],["$","span","2",{"className":"styles_function__1eRN9","children":"query"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":" ","children":","}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","8",{"className":"","children":"binds"}],["$","span","9",{"className":"","children":")"}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"","children":"{"}],["$","span","12",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" connection"}],["$","span","3",{"className":"","children":"."}],["$","span","4",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","5",{"className":"","children":"("}],["$","span","6",{"className":"","children":"{"}],["$","span","7",{"className":"","children":" "}],["$","span","8",{"className":" styles_property__BaBI9","children":"sql"}],["$","span","9",{"className":"styles_operator__ty4_w","children":":"}],["$","span","10",{"className":"","children":" parts"}],["$","span","11",{"className":"","children":"."}],["$","span","12",{"className":"styles_function__1eRN9","children":"join"}],["$","span","13",{"className":"","children":"("}],["$","span","14",{"className":"styles_string__bCSta","children":"\"$\""}],["$","span","15",{"className":"","children":")"}],["$","span","16",{"className":"","children":","}],["$","span","17",{"className":"","children":" binds "}],["$","span","18",{"className":"","children":"}"}],["$","span","19",{"className":"","children":")"}],["$","span","20",{"className":"","children":";"}],["$","span","21",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","4",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"result"}],["$","span","5",{"className":"","children":"]"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"styles_operator__ty4_w","children":"="}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_keyword__RcxoL","children":"await"}],["$","span","10",{"className":"","children":" query"}],["$","span","11",{"className":"  styles_string__bCSta","children":"`"}],["$","span","12",{"className":" styles_string__bCSta","children":"SELECT * FROM users WHERE id = "}],["$","span","13",{"className":"   ","children":"$${"}],["$","span","14",{"className":" ","children":"id"}],["$","span","15",{"className":"   ","children":"}"}],["$","span","16",{"className":"  styles_string__bCSta","children":"`"}],["$","span","17",{"className":"","children":";"}]]}]]}]}],["$","p",null,{"children":["The first thing I needed to fix was that a query would execute immediately, right when it was defined. It would be better if it would run only when ",["$","code",null,{"children":"await"}],"ed. This can be accomplished with \"lazy\" promises by creating an object with a ",["$","code",null,{"children":"then"}]," ","method."]}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","1",{"className":"","children":" "}],["$","span","2",{"className":"styles_function__1eRN9","children":"query"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":" ","children":","}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","8",{"className":"","children":"binds"}],["$","span","9",{"className":"","children":")"}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"","children":"{"}],["$","span","12",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"{"}],["$","span","4",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"styles_function__1eRN9","children":"then"}],["$","span","2",{"className":"","children":"("}],["$","span","3",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","4",{"className":"","children":"args"}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}],["$","span","8",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" connection"}]]}],["$","div","4",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"        "}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"{"}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":" styles_property__BaBI9","children":"sql"}],["$","span","7",{"className":"styles_operator__ty4_w","children":":"}],["$","span","8",{"className":"","children":" parts"}],["$","span","9",{"className":"","children":"."}],["$","span","10",{"className":"styles_function__1eRN9","children":"join"}],["$","span","11",{"className":"","children":"("}],["$","span","12",{"className":"styles_string__bCSta","children":"\"$\""}],["$","span","13",{"className":"","children":")"}],["$","span","14",{"className":"","children":","}],["$","span","15",{"className":"","children":" binds "}],["$","span","16",{"className":"","children":"}"}],["$","span","17",{"className":"","children":")"}],["$","span","18",{"className":"","children":""}]]}],["$","div","5",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"        "}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"then"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"styles_operator__ty4_w","children":"..."}],["$","span","5",{"className":"","children":"args"}],["$","span","6",{"className":"","children":")"}],["$","span","7",{"className":"","children":";"}],["$","span","8",{"className":"","children":""}]]}],["$","div","6",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}]]}]]}]}],["$","p",null,{"children":["I wanted this tool to be database agnostic so I extracted the execution logic and renamed the helper to ",["$","code",null,{"children":"$$"}]," to be more succinct:"]}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","1",{"className":"","children":" "}],["$","span","2",{"className":" styles_function__1eRN9","children":"makeQuery"}],["$","span","3",{"className":"","children":" "}],["$","span","4",{"className":"styles_operator__ty4_w","children":"="}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":"","children":"execute"}],["$","span","7",{"className":"","children":" "}],["$","span","8",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","11",{"className":"","children":" "}],["$","span","12",{"className":"styles_function__1eRN9","children":"query"}],["$","span","13",{"className":"","children":"("}],["$","span","14",{"className":"","children":"parts"}],["$","span","15",{"className":" ","children":","}],["$","span","16",{"className":"","children":" "}],["$","span","17",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","18",{"className":"","children":"binds"}],["$","span","19",{"className":"","children":")"}],["$","span","20",{"className":"","children":" "}],["$","span","21",{"className":"","children":"{"}],["$","span","22",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"{"}],["$","span","4",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"styles_function__1eRN9","children":"then"}],["$","span","2",{"className":"","children":"("}],["$","span","3",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","4",{"className":"","children":"args"}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}],["$","span","8",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"","children":"parts"}],["$","span","6",{"className":"","children":","}],["$","span","7",{"className":"","children":" binds"}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":"."}],["$","span","10",{"className":"styles_function__1eRN9","children":"then"}],["$","span","11",{"className":"","children":"("}],["$","span","12",{"className":"styles_operator__ty4_w","children":"..."}],["$","span","13",{"className":"","children":"args"}],["$","span","14",{"className":"","children":")"}],["$","span","15",{"className":"","children":";"}],["$","span","16",{"className":"","children":""}]]}],["$","div","4",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":","}],["$","span","3",{"className":"","children":""}]]}],["$","div","5",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","6",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","7",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","8",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" $ "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"styles_function__1eRN9","children":"makeQuery"}],["$","span","6",{"className":"","children":"("}],["$","span","7",{"className":"","children":"("}],["$","span","8",{"className":"","children":"parts"}],["$","span","9",{"className":" ","children":","}],["$","span","10",{"className":"","children":" binds"}],["$","span","11",{"className":"","children":")"}],["$","span","12",{"className":"","children":" "}],["$","span","13",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","14",{"className":"","children":""}]]}],["$","div","9",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  connection"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"{"}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":" styles_property__BaBI9","children":"sql"}],["$","span","7",{"className":"styles_operator__ty4_w","children":":"}],["$","span","8",{"className":"","children":" parts"}],["$","span","9",{"className":"","children":"."}],["$","span","10",{"className":"styles_function__1eRN9","children":"join"}],["$","span","11",{"className":"","children":"("}],["$","span","12",{"className":"styles_string__bCSta","children":"\"$\""}],["$","span","13",{"className":"","children":")"}],["$","span","14",{"className":"","children":","}],["$","span","15",{"className":"","children":" binds "}],["$","span","16",{"className":"","children":"}"}],["$","span","17",{"className":"","children":")"}],["$","span","18",{"className":"","children":","}],["$","span","19",{"className":"","children":""}]]}],["$","div","10",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":")"}]]}]]}]}]]}],["$","section",null,{"id":"Query%20Composition","children":[["$","h2",null,{"children":"Query Composition"}],["$","p",null,{"children":"There was a key feature that was missing: query composition. So far, the helper supported interpolating variables, but not other subqueries themselves."}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_comment__UauEA","children":"// Not (yet) supported"}],["$","span","1",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" lastDay "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" query"}],["$","span","5",{"className":"  styles_string__bCSta","children":"`"}],["$","span","6",{"className":" styles_string__bCSta","children":"created_at > current_timestamp() - interval '1' day"}],["$","span","7",{"className":"  styles_string__bCSta","children":"`"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" results "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"styles_keyword__RcxoL","children":"await"}],["$","span","6",{"className":"","children":" query"}],["$","span","7",{"className":"  styles_string__bCSta","children":"`"}],["$","span","8",{"className":" styles_string__bCSta","children":"SELECT * FROM ads WHERE "}],["$","span","9",{"className":"   ","children":"$${"}],["$","span","10",{"className":" ","children":"lastDay"}],["$","span","11",{"className":"   ","children":"}"}],["$","span","12",{"className":"  styles_string__bCSta","children":"`"}],["$","span","13",{"className":"","children":";"}]]}]]}]}],["$","p",null,{"children":"Nested queries were more difficult to support. There were two things that needed to be done to support them: determine a nested query from a variable bind and unnesting the nested queries."}],["$","p",null,{"children":["We can determine a query from other types with a Javascript idiom where we use a ",["$","code",null,{"children":"Symbol"}]," to allow conversion of a value into another type. This pattern is used by Javascript to implement iteration via"," ",["$","code",null,{"children":"Symbol.iterator"}],"."]}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","1",{"className":"","children":" toQuery "}],["$","span","2",{"className":"styles_operator__ty4_w","children":"="}],["$","span","3",{"className":"","children":" "}],["$","span","4",{"className":"styles_keyword__RcxoL","children":"new"}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":"","children":"Symbol"}],["$","span","7",{"className":"","children":"("}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":";"}],["$","span","10",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":" styles_function__1eRN9","children":"makeQuery"}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"="}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"execute"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","12",{"className":"","children":" "}],["$","span","13",{"className":"styles_function__1eRN9","children":"query"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"","children":"parts"}],["$","span","16",{"className":" ","children":","}],["$","span","17",{"className":"","children":" "}],["$","span","18",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","19",{"className":"","children":"binds"}],["$","span","20",{"className":"","children":")"}],["$","span","21",{"className":"","children":" "}],["$","span","22",{"className":"","children":"{"}],["$","span","23",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"{"}],["$","span","4",{"className":"","children":""}]]}],["$","div","4",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"["}],["$","span","2",{"className":"","children":"toQuery"}],["$","span","3",{"className":"","children":"]"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}],["$","span","8",{"className":"","children":""}]]}],["$","div","5",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" binds"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","6",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":","}],["$","span","3",{"className":"","children":""}]]}],["$","div","7",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"styles_function__1eRN9","children":"then"}],["$","span","2",{"className":"","children":"("}],["$","span","3",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","4",{"className":"","children":"args"}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}]]}]]}]}],["$","p",null,{"children":"To unnest the nested query, we have to iterate over the static parts of the query and the binds. In addition to flattening the top level and nested parts and binds, the first and last parts of each nested query must be concatenated to the surrounding parts in the top level query."}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","1",{"className":"","children":" toQuery "}],["$","span","2",{"className":"styles_operator__ty4_w","children":"="}],["$","span","3",{"className":"","children":" "}],["$","span","4",{"className":"styles_keyword__RcxoL","children":"new"}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":"","children":"Symbol"}],["$","span","7",{"className":"","children":"("}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":";"}],["$","span","10",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","2",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_function__1eRN9","children":"unnest"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":" ","children":"["}],["$","span","6",{"className":"","children":"firstPart"}],["$","span","7",{"className":" ","children":","}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","10",{"className":"","children":"nestedParts"}],["$","span","11",{"className":" ","children":"]"}],["$","span","12",{"className":" ","children":","}],["$","span","13",{"className":"","children":" nestedBinds"}],["$","span","14",{"className":"","children":")"}],["$","span","15",{"className":"","children":" "}],["$","span","16",{"className":"","children":"{"}],["$","span","17",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" parts "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"","children":"["}],["$","span","6",{"className":"","children":"firstPart"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","4",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" binds "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"","children":"["}],["$","span","6",{"className":"","children":"]"}],["$","span","7",{"className":"","children":";"}],["$","span","8",{"className":"","children":""}]]}],["$","div","5",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  nestedBinds"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"forEach"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"","children":"bind"}],["$","span","6",{"className":" ","children":","}],["$","span","7",{"className":"","children":" index"}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","11",{"className":"","children":" "}],["$","span","12",{"className":"","children":"{"}],["$","span","13",{"className":"","children":""}]]}],["$","div","6",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"if"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"bind "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"&&"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"styles_keyword__RcxoL","children":"typeof"}],["$","span","8",{"className":"","children":" bind "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"==="}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"styles_string__bCSta","children":"\"object\""}],["$","span","12",{"className":"","children":" "}],["$","span","13",{"className":"styles_operator__ty4_w","children":"&&"}],["$","span","14",{"className":"","children":" toQuery "}],["$","span","15",{"className":"styles_keyword__RcxoL","children":"in"}],["$","span","16",{"className":"","children":" bind"}],["$","span","17",{"className":"","children":")"}],["$","span","18",{"className":"","children":" "}],["$","span","19",{"className":"","children":"{"}],["$","span","20",{"className":"","children":""}]]}],["$","div","7",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"bindParts"}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" bindBinds"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"="}],["$","span","10",{"className":"","children":" bind"}],["$","span","11",{"className":"","children":"["}],["$","span","12",{"className":"","children":"toQuery"}],["$","span","13",{"className":"","children":"]"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"","children":")"}],["$","span","16",{"className":"","children":";"}],["$","span","17",{"className":"","children":""}]]}],["$","div","8",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      parts"}],["$","span","1",{"className":"","children":"["}],["$","span","2",{"className":"","children":"parts"}],["$","span","3",{"className":"","children":"."}],["$","span","4",{"className":"","children":"length "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"-"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"styles_number__dhAtQ","children":"1"}],["$","span","8",{"className":"","children":"]"}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":"styles_operator__ty4_w","children":"+="}],["$","span","11",{"className":"","children":" bindParts"}],["$","span","12",{"className":"","children":"["}],["$","span","13",{"className":"styles_number__dhAtQ","children":"0"}],["$","span","14",{"className":"","children":"]"}],["$","span","15",{"className":"","children":";"}],["$","span","16",{"className":"","children":""}]]}],["$","div","9",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      parts"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"push"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"styles_operator__ty4_w","children":"..."}],["$","span","5",{"className":"","children":"bindParts"}],["$","span","6",{"className":"","children":"."}],["$","span","7",{"className":"styles_function__1eRN9","children":"slice"}],["$","span","8",{"className":"","children":"("}],["$","span","9",{"className":"styles_number__dhAtQ","children":"1"}],["$","span","10",{"className":"","children":")"}],["$","span","11",{"className":"","children":")"}],["$","span","12",{"className":"","children":";"}],["$","span","13",{"className":"","children":""}]]}],["$","div","10",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      parts"}],["$","span","1",{"className":"","children":"["}],["$","span","2",{"className":"","children":"parts"}],["$","span","3",{"className":"","children":"."}],["$","span","4",{"className":"","children":"length "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"-"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"styles_number__dhAtQ","children":"1"}],["$","span","8",{"className":"","children":"]"}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":"styles_operator__ty4_w","children":"+="}],["$","span","11",{"className":"","children":" nestedParts"}],["$","span","12",{"className":"","children":"["}],["$","span","13",{"className":"","children":"index"}],["$","span","14",{"className":"","children":"]"}],["$","span","15",{"className":"","children":";"}],["$","span","16",{"className":"","children":""}]]}],["$","div","11",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      binds"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"push"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"styles_operator__ty4_w","children":"..."}],["$","span","5",{"className":"","children":"bindBinds"}],["$","span","6",{"className":"","children":")"}],["$","span","7",{"className":"","children":";"}],["$","span","8",{"className":"","children":""}]]}],["$","div","12",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_keyword__RcxoL","children":"else"}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"","children":"{"}],["$","span","6",{"className":"","children":""}]]}],["$","div","13",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      parts"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"push"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"nestedParts"}],["$","span","5",{"className":"","children":"["}],["$","span","6",{"className":"","children":"index"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":";"}],["$","span","10",{"className":"","children":""}]]}],["$","div","14",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      binds"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"push"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"bind"}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":";"}],["$","span","7",{"className":"","children":""}]]}],["$","div","15",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","16",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":")"}],["$","span","3",{"className":"","children":";"}],["$","span","4",{"className":"","children":""}]]}],["$","div","17",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" binds"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","18",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","19",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","20",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":" styles_function__1eRN9","children":"makeQuery"}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"="}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"execute"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","12",{"className":"","children":" "}],["$","span","13",{"className":"styles_function__1eRN9","children":"query"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"","children":"inParts"}],["$","span","16",{"className":" ","children":","}],["$","span","17",{"className":"","children":" "}],["$","span","18",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","19",{"className":"","children":"inBinds"}],["$","span","20",{"className":"","children":")"}],["$","span","21",{"className":"","children":" "}],["$","span","22",{"className":"","children":"{"}],["$","span","23",{"className":"","children":""}]]}],["$","div","21",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" binds"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"="}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"styles_function__1eRN9","children":"unnest"}],["$","span","12",{"className":"","children":"("}],["$","span","13",{"className":"","children":"inParts"}],["$","span","14",{"className":"","children":","}],["$","span","15",{"className":"","children":" inBinds"}],["$","span","16",{"className":"","children":")"}],["$","span","17",{"className":"","children":";"}],["$","span","18",{"className":"","children":""}]]}],["$","div","22",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"{"}]]}]]}]}]]}],["$","section",null,{"id":"Async%20Iteration","children":[["$","h2",null,{"children":"Async Iteration"}],["$","p",null,{"children":"One final feature I wanted to add as a performance optimization was async iteration. When I was developing this tool, I was loading a lot of data from the database during jobs, but only needed one record at a time."}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"async"}],["$","span","1",{"className":"","children":" "}],["$","span","2",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","3",{"className":"","children":" "}],["$","span","4",{"className":"styles_function__1eRN9","children":"collect"}],["$","span","5",{"className":"","children":"("}],["$","span","6",{"className":"","children":"iterator"}],["$","span","7",{"className":"","children":")"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"","children":"{"}],["$","span","10",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" result "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"","children":"["}],["$","span","6",{"className":"","children":"]"}],["$","span","7",{"className":"","children":";"}],["$","span","8",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"for"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_keyword__RcxoL","children":"await"}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"","children":"("}],["$","span","6",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","7",{"className":"","children":" item "}],["$","span","8",{"className":"styles_keyword__RcxoL","children":"of"}],["$","span","9",{"className":"","children":" iterator"}],["$","span","10",{"className":"","children":")"}],["$","span","11",{"className":"","children":" result"}],["$","span","12",{"className":"","children":"."}],["$","span","13",{"className":"styles_function__1eRN9","children":"push"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"","children":"item"}],["$","span","16",{"className":"","children":")"}],["$","span","17",{"className":"","children":";"}],["$","span","18",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" result"}],["$","span","3",{"className":"","children":";"}],["$","span","4",{"className":"","children":""}]]}],["$","div","4",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","5",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","6",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":" styles_function__1eRN9","children":"makeQuery"}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"="}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"execute"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","12",{"className":"","children":" "}],["$","span","13",{"className":"styles_function__1eRN9","children":"query"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"","children":"parts"}],["$","span","16",{"className":" ","children":","}],["$","span","17",{"className":"","children":" "}],["$","span","18",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","19",{"className":"","children":"binds"}],["$","span","20",{"className":"","children":")"}],["$","span","21",{"className":"","children":" "}],["$","span","22",{"className":"","children":"{"}],["$","span","23",{"className":"","children":""}]]}],["$","div","7",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"{"}],["$","span","4",{"className":"","children":""}]]}],["$","div","8",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"["}],["$","span","2",{"className":"","children":"toQuery"}],["$","span","3",{"className":"","children":"]"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}],["$","span","8",{"className":"","children":""}]]}],["$","div","9",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" binds"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","10",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":","}],["$","span","3",{"className":"","children":""}]]}],["$","div","11",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"styles_function__1eRN9","children":"then"}],["$","span","2",{"className":"","children":"("}],["$","span","3",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","4",{"className":"","children":"args"}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}],["$","span","8",{"className":"","children":""}]]}],["$","div","12",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_function__1eRN9","children":"collect"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"styles_keyword__RcxoL","children":"this"}],["$","span","6",{"className":"","children":")"}],["$","span","7",{"className":"","children":"."}],["$","span","8",{"className":"styles_function__1eRN9","children":"then"}],["$","span","9",{"className":"","children":"("}],["$","span","10",{"className":"styles_operator__ty4_w","children":"..."}],["$","span","11",{"className":"","children":"args"}],["$","span","12",{"className":"","children":")"}],["$","span","13",{"className":"","children":";"}],["$","span","14",{"className":"","children":""}]]}],["$","div","13",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":","}],["$","span","3",{"className":"","children":""}]]}],["$","div","14",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"["}],["$","span","2",{"className":"","children":"Symbol"}],["$","span","3",{"className":"","children":"."}],["$","span","4",{"className":"","children":"asyncIterator"}],["$","span","5",{"className":"","children":"]"}],["$","span","6",{"className":"","children":"("}],["$","span","7",{"className":"","children":")"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"","children":"{"}],["$","span","10",{"className":"","children":""}]]}],["$","div","15",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"","children":"parts"}],["$","span","6",{"className":"","children":","}],["$","span","7",{"className":"","children":" binds"}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":";"}],["$","span","10",{"className":"","children":""}]]}],["$","div","16",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":","}],["$","span","3",{"className":"","children":""}]]}],["$","div","17",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","18",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}]]}]]}]}],["$","p",null,{"children":"This also requires a change to the execute function as well, which will depend greatly on the database library."}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","1",{"className":"","children":" $ "}],["$","span","2",{"className":"styles_operator__ty4_w","children":"="}],["$","span","3",{"className":"","children":" "}],["$","span","4",{"className":"styles_function__1eRN9","children":"makeQuery"}],["$","span","5",{"className":"","children":"("}],["$","span","6",{"className":"","children":"("}],["$","span","7",{"className":"","children":"parts"}],["$","span","8",{"className":" ","children":","}],["$","span","9",{"className":"","children":" binds"}],["$","span","10",{"className":"","children":")"}],["$","span","11",{"className":"","children":" "}],["$","span","12",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","13",{"className":"","children":" "}],["$","span","14",{"className":"","children":"{"}],["$","span","15",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" result "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" connection"}],["$","span","5",{"className":"","children":"."}],["$","span","6",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","7",{"className":"","children":"("}],["$","span","8",{"className":"","children":"{"}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":" styles_property__BaBI9","children":"sql"}],["$","span","11",{"className":"styles_operator__ty4_w","children":":"}],["$","span","12",{"className":"","children":" parts"}],["$","span","13",{"className":"","children":"."}],["$","span","14",{"className":"styles_function__1eRN9","children":"join"}],["$","span","15",{"className":"","children":"("}],["$","span","16",{"className":"styles_string__bCSta","children":"\"$\""}],["$","span","17",{"className":"","children":")"}],["$","span","18",{"className":"","children":","}],["$","span","19",{"className":"","children":" binds "}],["$","span","20",{"className":"","children":"}"}],["$","span","21",{"className":"","children":")"}],["$","span","22",{"className":"","children":";"}],["$","span","23",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" result"}],["$","span","3",{"className":"","children":"."}],["$","span","4",{"className":"styles_function__1eRN9","children":"streamRows"}],["$","span","5",{"className":"","children":"("}],["$","span","6",{"className":"","children":")"}],["$","span","7",{"className":"","children":";"}],["$","span","8",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":")"}]]}]]}]}]]}],["$","section",null,{"id":"Conclusion","children":[["$","h2",null,{"children":"Conclusion"}],["$","p",null,{"children":"This tool can be a great help for certain scenarios, particularly those that are using complex SQL queries, probably doing some kind of data analysis. But for more typical transactional workflows, query builders or even an ORM can better suited to the task."}],["$","h3",null,{"children":"Further Reading:"}],["$","ul",null,{"children":[["$","li",null,{"children":[["$","a",null,{"href":"https://github.com/spencerschack/spencerschack.github.io/blob/next/src/app/query/query.ts","children":"query.ts"}],": The full, Typescript version of this tool."]}],["$","li",null,{"children":[["$","a",null,{"href":"https://martinfowler.com/bliki/MinimalInterface.html","children":"MinimalInterface"}],": What is a “minimal interface” and why it might be better than a “humane interface”."]}],["$","li",null,{"children":[["$","a",null,{"href":"https://github.com/blakeembrey/sql-template-tag","children":"sql-template-tag"}],": Another implementation without some features (",["$","code",null,{"children":"then"}],"able result, async iteration). Database agnostic, but supports"," ",["$","code",null,{"children":"pg"}]," and ",["$","code",null,{"children":"mysql"}]," out of the box."]}],["$","li",null,{"children":[["$","a",null,{"href":"https://github.com/andywer/squid","children":"squid"}],": Similar features to ",["$","code",null,{"children":"sql-template-tag"}],", but supports static query validations via ",["$","code",null,{"children":"postguard"}],". Only supports Postgres."]}]]}]]}]]}]]}]]}]

1:HL["/_next/static/media/886f446b96dc7734-s.p.woff2",{"as":"font","type":"font/woff2"}]
2:HL["/_next/static/media/e693e841d50dcf2f-s.p.woff2",{"as":"font","type":"font/woff2"}]
3:HL["/_next/static/css/e9404df9fbf74e84.css",{"as":"style"}]
0:[[["",{"children":["query",{"children":["__PAGE__",{}]}]},"$undefined","$undefined",true],"$L4",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/e9404df9fbf74e84.css","precedence":"next"}]],["$L5",["$","meta",null,{"name":"next-size-adjust"}]]]]]
6:HL["/_next/static/css/c962a6af8b108908.css",{"as":"style"}]
7:I{"id":"4463","chunks":["272:static/chunks/webpack-dfe2bd72f6ec4541.js","667:static/chunks/2443530c-824e93370d7398c3.js","488:static/chunks/488-e1ddd61bb847c097.js"],"name":"","async":false}
8:I{"id":"1010","chunks":["272:static/chunks/webpack-dfe2bd72f6ec4541.js","667:static/chunks/2443530c-824e93370d7398c3.js","488:static/chunks/488-e1ddd61bb847c097.js"],"name":"","async":false}
4:[["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__className_5a5ee9","children":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","query","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$L9",null],"segment":"__PAGE__"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/c962a6af8b108908.css","precedence":"next"}]]}],"segment":"query"},"styles":[]}]}]}],null]
5:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"spencerschack.com"}],null,null,null,null,null,null,null,null,null,["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]],[],null]]
a:I{"id":"551","chunks":["400:static/chunks/400-cbc4b555966ccbff.js","25:static/chunks/app/query/page-2fe381935312871e.js"],"name":"","async":false}
9:["$","div",null,{"className":"styles_root__FGv06","children":[["$","$La",null,{"initialResults":{"columns":["id","user_id","product_id","quantity","date","id","first_name","last_name","email","join_date","id","name","price"],"values":[[1,75,11,4,"2020-08-07",75,"Tate","Langosh","Tate_Langosh@gmail.com","Thu Jun 27",11,"Bacon","261.00"],[2,100,15,2,"2022-11-03",100,"Lisa","Schuster","Lisa_Schuster@hotmail.com","Sat Jun 11",15,"Tuna","937.00"],[3,37,5,4,"2020-07-29",37,"Mathilde","Glover","Mathilde94@yahoo.com","Sat Aug 20",5,"Computer","619.00"],[4,34,18,5,"2020-09-01",34,"Bonita","Hermiston","Bonita.Hermiston27@gmail.com","Tue May 03",18,"Bacon","968.00"],[5,86,5,2,"2020-01-30",86,"Armando","Keebler","Armando.Keebler5@hotmail.com","Thu Aug 11",5,"Computer","619.00"],[6,75,15,4,"2022-04-15",75,"Tate","Langosh","Tate_Langosh@gmail.com","Thu Jun 27",15,"Tuna","937.00"],[7,10,7,5,"2020-10-22",10,"Adonis","Weissnat","Adonis_Weissnat@hotmail.com","Tue Jul 20",7,"Car","656.00"],[8,51,10,4,"2021-07-13",51,"Chandler","Wunsch","Chandler_Wunsch@yahoo.com","Fri Mar 04",10,"Chair","341.00"],[9,32,6,5,"2022-12-23",32,"Electa","Braun","Electa_Braun@hotmail.com","Sat May 21",6,"Chicken","337.00"],[10,39,1,0,"2018-09-08",39,"Wanda","Windler","Wanda69@gmail.com","Mon Dec 28",1,"Mouse","274.00"],[11,91,17,0,"2021-09-14",91,"Blanche","Heaney","Blanche4@gmail.com","Mon Jan 02",17,"Fish","418.00"],[12,32,20,5,"2020-02-05",32,"Electa","Braun","Electa_Braun@hotmail.com","Sat May 21",20,"Mouse","424.00"],[13,96,10,3,"2021-01-05",96,"Torrey","Kutch","Torrey_Kutch@hotmail.com","Wed Jan 22",10,"Chair","341.00"],[14,63,1,2,"2023-01-07",63,"Susie","Kerluke","Susie_Kerluke@hotmail.com","Thu Apr 02",1,"Mouse","274.00"],[15,29,12,1,"2020-09-16",29,"Kelvin","Powlowski","Kelvin24@hotmail.com","Mon Jun 15",12,"Ball","497.00"],[16,67,4,4,"2018-10-01",67,"Fritz","Armstrong","Fritz.Armstrong42@hotmail.com","Fri Sep 18",4,"Chair","39.00"],[17,79,16,4,"2022-11-29",79,"Kari","Grant-Smitham","Kari.Grant-Smitham25@yahoo.com","Sun Apr 16",16,"Salad","40.00"],[18,9,19,2,"2018-08-11",9,"Jamir","Stokes","Jamir.Stokes45@yahoo.com","Sat Feb 25",19,"Ball","548.00"],[19,5,20,3,"2023-03-14",5,"Zachary","Mosciski","Zachary_Mosciski@gmail.com","Sat Jun 10",20,"Mouse","424.00"],[20,44,15,5,"2020-09-30",44,"David","Rempel","David.Rempel@hotmail.com","Sat Apr 25",15,"Tuna","937.00"]]},"initialCode":"const newUsers = query`\n  SELECT *\n  FROM users\n  WHERE join_date > \"2021-02-01\"\n`;\nreturn query`\n  SELECT *\n  FROM orders\n  INNER JOIN (${newUsers}) new_users\n    ON orders.user_id = new_users.id\n  INNER JOIN products\n    ON orders.product_id = products.id\n  LIMIT 20\n`;"}],["$","div",null,{"className":"styles_container__b_OzL","children":[["$","ol",null,{"className":"styles_toc__bIATy","children":[["$","li",null,{"children":["$","a",null,{"href":"#Demo","children":"Demo"}]}],[["$","li","Background",{"children":["$","a",null,{"href":"#Background","children":"Background"}]}],["$","li","Motivation",{"children":["$","a",null,{"href":"#Motivation","children":"Motivation"}]}],["$","li","Experimentation",{"children":["$","a",null,{"href":"#Experimentation","children":"Experimentation"}]}],["$","li","Implementation",{"children":["$","a",null,{"href":"#Implementation","children":"Implementation"}]}],["$","li","Query Composition",{"children":["$","a",null,{"href":"#Query%20Composition","children":"Query Composition"}]}],["$","li","Async Iteration",{"children":["$","a",null,{"href":"#Async%20Iteration","children":"Async Iteration"}]}],["$","li","Conclusion",{"children":["$","a",null,{"href":"#Conclusion","children":"Conclusion"}]}]]]}],["$","div",null,{"className":"styles_content__hvl__","children":[["$","section",null,{"id":"Background","children":[["$","h2",null,{"children":"Background"}],["$","p",null,{"children":["Writing SQL queries is often an inevitable part of software development. SQL is either written by hand or with the help of query builders. Query builders, such as"," ",["$","a",null,{"href":"https://guides.rubyonrails.org/active_record_basics.html","children":"ActiveRecord"}]," ","or ",["$","a",null,{"href":"https://knexjs.org/guide/query-builder.html#knex","children":"Knex"}],", are tools that help to create queries through an API native to the programming language you're executing the queries from."]}]]}],["$","section",null,{"id":"Motivation","children":[["$","h2",null,{"children":"Motivation"}],["$","p",null,{"children":"Query builders can be very useful when writing simple queries:"}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_function__1eRN9","children":"knex"}],["$","span","1",{"className":"","children":"("}],["$","span","2",{"className":"styles_string__bCSta","children":"'posts'"}],["$","span","3",{"className":"","children":")"}],["$","span","4",{"className":"","children":"."}],["$","span","5",{"className":"styles_function__1eRN9","children":"where"}],["$","span","6",{"className":"","children":"("}],["$","span","7",{"className":"styles_string__bCSta","children":"'category_id'"}],["$","span","8",{"className":"","children":","}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":"styles_number__dhAtQ","children":"42"}],["$","span","11",{"className":"","children":")"}],["$","span","12",{"className":"","children":"."}],["$","span","13",{"className":"styles_function__1eRN9","children":"orderBy"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"styles_string__bCSta","children":"'created_at'"}],["$","span","16",{"className":"","children":")"}],["$","span","17",{"className":"","children":";"}]]}]]}]}],["$","p",null,{"children":"However, this approach does have some downsides:"}],["$","ul",null,{"children":[["$","li",null,{"children":"Every query feature in your target database needs a corresponding query builder API. The effort to develop, maintain, and learn how to use the query builder is coupled with how many features you want to use."}],["$","li",null,{"children":"SQL is a standardized, widely-used language that enables developers to share their ability to query databases across projects and teams. The benefits of the widespread familiarity with SQL is lost when each query builder has a unique API."}]]}]]}],["$","section",null,{"id":"Experimentation","children":[["$","h2",null,{"children":"Experimentation"}],["$","p",null,{"children":"Writing queries by hand with strings and variable interpolation is not the answer either because of the need to mitigate SQL injestion and correctly serialize the variables."}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_comment__UauEA","children":"// This is susceptible to SQL injection and wouldn't"}],["$","span","1",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_comment__UauEA","children":"// correctly interpolate string literals."}],["$","span","2",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"connection"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"  styles_string__bCSta","children":"`"}],["$","span","5",{"className":" styles_string__bCSta","children":"SELECT * FROM users WHERE id = "}],["$","span","6",{"className":"   ","children":"$${"}],["$","span","7",{"className":" ","children":"id"}],["$","span","8",{"className":"   ","children":"}"}],["$","span","9",{"className":"  styles_string__bCSta","children":"`"}],["$","span","10",{"className":"","children":")"}],["$","span","11",{"className":"","children":";"}]]}]]}]}],["$","p",null,{"children":"Javascript does have a language feature that helps these solves issues. Tagged template literals:"}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"query"}],["$","span","1",{"className":"  styles_string__bCSta","children":"`"}],["$","span","2",{"className":" styles_string__bCSta","children":"SELECT * FROM users WHERE id = "}],["$","span","3",{"className":"   ","children":"$${"}],["$","span","4",{"className":" ","children":"id"}],["$","span","5",{"className":"   ","children":"}"}],["$","span","6",{"className":" styles_string__bCSta","children":" "}],["$","span","7",{"className":"  styles_string__bCSta","children":"`"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_comment__UauEA","children":"// is equivalent to"}],["$","span","2",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_function__1eRN9","children":"query"}],["$","span","2",{"className":"","children":"("}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"styles_string__bCSta","children":"\"SELECT * FROM users WHERE id = \""}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"styles_string__bCSta","children":"\"\""}],["$","span","8",{"className":"","children":"]"}],["$","span","9",{"className":"","children":","}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"","children":"["}],["$","span","12",{"className":"","children":"id"}],["$","span","13",{"className":"","children":"]"}],["$","span","14",{"className":"","children":")"}],["$","span","15",{"className":"","children":";"}]]}]]}]}],["$","p",null,{"children":"I wanted to create an interface for writing SQL to work like it was part of the source code instead of just a string parameter. Similar to JSX where building html elements is baked into the language for better ergonomics. The end goal was something like this:"}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","1",{"className":"","children":" "}],["$","span","2",{"className":"","children":"["}],["$","span","3",{"className":"","children":"result"}],["$","span","4",{"className":"","children":"]"}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":"styles_operator__ty4_w","children":"="}],["$","span","7",{"className":"","children":" "}],["$","span","8",{"className":"styles_keyword__RcxoL","children":"await"}],["$","span","9",{"className":"","children":" query"}],["$","span","10",{"className":"  styles_string__bCSta","children":"`"}],["$","span","11",{"className":" styles_string__bCSta","children":"SELECT * FROM users WHERE id = "}],["$","span","12",{"className":"   ","children":"$${"}],["$","span","13",{"className":" ","children":"id"}],["$","span","14",{"className":"   ","children":"}"}],["$","span","15",{"className":"  styles_string__bCSta","children":"`"}],["$","span","16",{"className":"","children":";"}]]}]]}]}]]}],["$","section",null,{"id":"Implementation","children":[["$","h2",null,{"children":"Implementation"}],["$","p",null,{"children":["My first step was creating something like"," ",["$","a",null,{"href":"https://github.com/blakeembrey/sql-template-tag","children":"sql-template-tag"}]," ","using"," ",["$","a",null,{"href":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates","children":"tagged template literals"}],". This single line function already completed about 80% of the API."]}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","1",{"className":"","children":" "}],["$","span","2",{"className":"styles_function__1eRN9","children":"query"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":" ","children":","}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","8",{"className":"","children":"binds"}],["$","span","9",{"className":"","children":")"}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"","children":"{"}],["$","span","12",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" connection"}],["$","span","3",{"className":"","children":"."}],["$","span","4",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","5",{"className":"","children":"("}],["$","span","6",{"className":"","children":"{"}],["$","span","7",{"className":"","children":" "}],["$","span","8",{"className":" styles_property__BaBI9","children":"sql"}],["$","span","9",{"className":"styles_operator__ty4_w","children":":"}],["$","span","10",{"className":"","children":" parts"}],["$","span","11",{"className":"","children":"."}],["$","span","12",{"className":"styles_function__1eRN9","children":"join"}],["$","span","13",{"className":"","children":"("}],["$","span","14",{"className":"styles_string__bCSta","children":"\"$\""}],["$","span","15",{"className":"","children":")"}],["$","span","16",{"className":"","children":","}],["$","span","17",{"className":"","children":" binds "}],["$","span","18",{"className":"","children":"}"}],["$","span","19",{"className":"","children":")"}],["$","span","20",{"className":"","children":";"}],["$","span","21",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","4",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"result"}],["$","span","5",{"className":"","children":"]"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"styles_operator__ty4_w","children":"="}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_keyword__RcxoL","children":"await"}],["$","span","10",{"className":"","children":" query"}],["$","span","11",{"className":"  styles_string__bCSta","children":"`"}],["$","span","12",{"className":" styles_string__bCSta","children":"SELECT * FROM users WHERE id = "}],["$","span","13",{"className":"   ","children":"$${"}],["$","span","14",{"className":" ","children":"id"}],["$","span","15",{"className":"   ","children":"}"}],["$","span","16",{"className":"  styles_string__bCSta","children":"`"}],["$","span","17",{"className":"","children":";"}]]}]]}]}],["$","p",null,{"children":["The first thing I needed to fix was that a query would execute immediately, right when it was defined. It would be better if it would run only when ",["$","code",null,{"children":"await"}],"ed. This can be accomplished with \"lazy\" promises by creating an object with a ",["$","code",null,{"children":"then"}]," ","method."]}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","1",{"className":"","children":" "}],["$","span","2",{"className":"styles_function__1eRN9","children":"query"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":" ","children":","}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","8",{"className":"","children":"binds"}],["$","span","9",{"className":"","children":")"}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"","children":"{"}],["$","span","12",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"{"}],["$","span","4",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"styles_function__1eRN9","children":"then"}],["$","span","2",{"className":"","children":"("}],["$","span","3",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","4",{"className":"","children":"args"}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}],["$","span","8",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" connection"}]]}],["$","div","4",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"        "}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"{"}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":" styles_property__BaBI9","children":"sql"}],["$","span","7",{"className":"styles_operator__ty4_w","children":":"}],["$","span","8",{"className":"","children":" parts"}],["$","span","9",{"className":"","children":"."}],["$","span","10",{"className":"styles_function__1eRN9","children":"join"}],["$","span","11",{"className":"","children":"("}],["$","span","12",{"className":"styles_string__bCSta","children":"\"$\""}],["$","span","13",{"className":"","children":")"}],["$","span","14",{"className":"","children":","}],["$","span","15",{"className":"","children":" binds "}],["$","span","16",{"className":"","children":"}"}],["$","span","17",{"className":"","children":")"}],["$","span","18",{"className":"","children":""}]]}],["$","div","5",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"        "}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"then"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"styles_operator__ty4_w","children":"..."}],["$","span","5",{"className":"","children":"args"}],["$","span","6",{"className":"","children":")"}],["$","span","7",{"className":"","children":";"}],["$","span","8",{"className":"","children":""}]]}],["$","div","6",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}]]}]]}]}],["$","p",null,{"children":"I wanted this tool to be database agnostic so I extracted the execution logic:"}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","1",{"className":"","children":" "}],["$","span","2",{"className":" styles_function__1eRN9","children":"makeQuery"}],["$","span","3",{"className":"","children":" "}],["$","span","4",{"className":"styles_operator__ty4_w","children":"="}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":"","children":"execute"}],["$","span","7",{"className":"","children":" "}],["$","span","8",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","11",{"className":"","children":" "}],["$","span","12",{"className":"styles_function__1eRN9","children":"query"}],["$","span","13",{"className":"","children":"("}],["$","span","14",{"className":"","children":"parts"}],["$","span","15",{"className":" ","children":","}],["$","span","16",{"className":"","children":" "}],["$","span","17",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","18",{"className":"","children":"binds"}],["$","span","19",{"className":"","children":")"}],["$","span","20",{"className":"","children":" "}],["$","span","21",{"className":"","children":"{"}],["$","span","22",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"{"}],["$","span","4",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"styles_function__1eRN9","children":"then"}],["$","span","2",{"className":"","children":"("}],["$","span","3",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","4",{"className":"","children":"args"}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}],["$","span","8",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"","children":"parts"}],["$","span","6",{"className":"","children":","}],["$","span","7",{"className":"","children":" binds"}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":"."}],["$","span","10",{"className":"styles_function__1eRN9","children":"then"}],["$","span","11",{"className":"","children":"("}],["$","span","12",{"className":"styles_operator__ty4_w","children":"..."}],["$","span","13",{"className":"","children":"args"}],["$","span","14",{"className":"","children":")"}],["$","span","15",{"className":"","children":";"}],["$","span","16",{"className":"","children":""}]]}],["$","div","4",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":","}],["$","span","3",{"className":"","children":""}]]}],["$","div","5",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","6",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","7",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","8",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" query "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"styles_function__1eRN9","children":"makeQuery"}],["$","span","6",{"className":"","children":"("}],["$","span","7",{"className":"","children":"("}],["$","span","8",{"className":"","children":"parts"}],["$","span","9",{"className":" ","children":","}],["$","span","10",{"className":"","children":" binds"}],["$","span","11",{"className":"","children":")"}],["$","span","12",{"className":"","children":" "}],["$","span","13",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","14",{"className":"","children":""}]]}],["$","div","9",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  connection"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"{"}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":" styles_property__BaBI9","children":"sql"}],["$","span","7",{"className":"styles_operator__ty4_w","children":":"}],["$","span","8",{"className":"","children":" parts"}],["$","span","9",{"className":"","children":"."}],["$","span","10",{"className":"styles_function__1eRN9","children":"join"}],["$","span","11",{"className":"","children":"("}],["$","span","12",{"className":"styles_string__bCSta","children":"\"$\""}],["$","span","13",{"className":"","children":")"}],["$","span","14",{"className":"","children":","}],["$","span","15",{"className":"","children":" binds "}],["$","span","16",{"className":"","children":"}"}],["$","span","17",{"className":"","children":")"}],["$","span","18",{"className":"","children":","}],["$","span","19",{"className":"","children":""}]]}],["$","div","10",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":")"}]]}]]}]}]]}],["$","section",null,{"id":"Query%20Composition","children":[["$","h2",null,{"children":"Query Composition"}],["$","p",null,{"children":"There was a key feature that was missing: query composition. So far, the helper supported interpolating variables, but not other subqueries themselves."}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_comment__UauEA","children":"// Not (yet) supported"}],["$","span","1",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" lastDay "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" query"}],["$","span","5",{"className":"  styles_string__bCSta","children":"`"}],["$","span","6",{"className":" styles_string__bCSta","children":"created_at > current_timestamp() - interval '1' day"}],["$","span","7",{"className":"  styles_string__bCSta","children":"`"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" results "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"styles_keyword__RcxoL","children":"await"}],["$","span","6",{"className":"","children":" query"}],["$","span","7",{"className":"  styles_string__bCSta","children":"`"}],["$","span","8",{"className":" styles_string__bCSta","children":"SELECT * FROM ads WHERE "}],["$","span","9",{"className":"   ","children":"$${"}],["$","span","10",{"className":" ","children":"lastDay"}],["$","span","11",{"className":"   ","children":"}"}],["$","span","12",{"className":"  styles_string__bCSta","children":"`"}],["$","span","13",{"className":"","children":";"}]]}]]}]}],["$","p",null,{"children":"Nested queries were more difficult to support. There were two things that needed to be done to support them: determine a nested query from a variable bind and unnesting the nested queries."}],["$","p",null,{"children":["We can determine a query from other types with a Javascript idiom where we use a ",["$","code",null,{"children":"Symbol"}]," to allow conversion of a value into another type. This pattern is used by Javascript to implement iteration via"," ",["$","code",null,{"children":"Symbol.iterator"}],"."]}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","1",{"className":"","children":" toQuery "}],["$","span","2",{"className":"styles_operator__ty4_w","children":"="}],["$","span","3",{"className":"","children":" "}],["$","span","4",{"className":"styles_keyword__RcxoL","children":"new"}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":"","children":"Symbol"}],["$","span","7",{"className":"","children":"("}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":";"}],["$","span","10",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":" styles_function__1eRN9","children":"makeQuery"}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"="}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"execute"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","12",{"className":"","children":" "}],["$","span","13",{"className":"styles_function__1eRN9","children":"query"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"","children":"parts"}],["$","span","16",{"className":" ","children":","}],["$","span","17",{"className":"","children":" "}],["$","span","18",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","19",{"className":"","children":"binds"}],["$","span","20",{"className":"","children":")"}],["$","span","21",{"className":"","children":" "}],["$","span","22",{"className":"","children":"{"}],["$","span","23",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"{"}],["$","span","4",{"className":"","children":""}]]}],["$","div","4",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"["}],["$","span","2",{"className":"","children":"toQuery"}],["$","span","3",{"className":"","children":"]"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}],["$","span","8",{"className":"","children":""}]]}],["$","div","5",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" binds"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","6",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":","}],["$","span","3",{"className":"","children":""}]]}],["$","div","7",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"styles_function__1eRN9","children":"then"}],["$","span","2",{"className":"","children":"("}],["$","span","3",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","4",{"className":"","children":"args"}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}]]}]]}]}],["$","p",null,{"children":"To unnest the nested query, we have to iterate over the static parts of the query and the binds. In addition to flattening the top level and nested parts and binds, the first and last parts of each nested query must be concatenated to the surrounding parts in the top level query."}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","1",{"className":"","children":" toQuery "}],["$","span","2",{"className":"styles_operator__ty4_w","children":"="}],["$","span","3",{"className":"","children":" "}],["$","span","4",{"className":"styles_keyword__RcxoL","children":"new"}],["$","span","5",{"className":"","children":" "}],["$","span","6",{"className":"","children":"Symbol"}],["$","span","7",{"className":"","children":"("}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":";"}],["$","span","10",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","2",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_function__1eRN9","children":"compile"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":" ","children":"["}],["$","span","6",{"className":"","children":"firstPart"}],["$","span","7",{"className":" ","children":","}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","10",{"className":"","children":"nestedParts"}],["$","span","11",{"className":" ","children":"]"}],["$","span","12",{"className":" ","children":","}],["$","span","13",{"className":"","children":" nestedBinds"}],["$","span","14",{"className":"","children":")"}],["$","span","15",{"className":"","children":" "}],["$","span","16",{"className":"","children":"{"}],["$","span","17",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" parts "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"","children":"["}],["$","span","6",{"className":"","children":"firstPart"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","4",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" binds "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"","children":"["}],["$","span","6",{"className":"","children":"]"}],["$","span","7",{"className":"","children":";"}],["$","span","8",{"className":"","children":""}]]}],["$","div","5",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  nestedBinds"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"forEach"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"","children":"bind"}],["$","span","6",{"className":" ","children":","}],["$","span","7",{"className":"","children":" index"}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","11",{"className":"","children":" "}],["$","span","12",{"className":"","children":"{"}],["$","span","13",{"className":"","children":""}]]}],["$","div","6",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"if"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"bind "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"&&"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"styles_keyword__RcxoL","children":"typeof"}],["$","span","8",{"className":"","children":" bind "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"==="}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"styles_string__bCSta","children":"\"object\""}],["$","span","12",{"className":"","children":" "}],["$","span","13",{"className":"styles_operator__ty4_w","children":"&&"}],["$","span","14",{"className":"","children":" toQuery "}],["$","span","15",{"className":"styles_keyword__RcxoL","children":"in"}],["$","span","16",{"className":"","children":" bind"}],["$","span","17",{"className":"","children":")"}],["$","span","18",{"className":"","children":" "}],["$","span","19",{"className":"","children":"{"}],["$","span","20",{"className":"","children":""}]]}],["$","div","7",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"nestedParts"}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" nestedBinds"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"="}],["$","span","10",{"className":"","children":" bind"}],["$","span","11",{"className":"","children":"["}],["$","span","12",{"className":"","children":"toQuery"}],["$","span","13",{"className":"","children":"]"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"","children":")"}],["$","span","16",{"className":"","children":";"}],["$","span","17",{"className":"","children":""}]]}],["$","div","8",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      parts"}],["$","span","1",{"className":"","children":"["}],["$","span","2",{"className":"","children":"parts"}],["$","span","3",{"className":"","children":"."}],["$","span","4",{"className":"","children":"length "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"-"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"styles_number__dhAtQ","children":"1"}],["$","span","8",{"className":"","children":"]"}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":"styles_operator__ty4_w","children":"+="}],["$","span","11",{"className":"","children":" nestedParts"}],["$","span","12",{"className":"","children":"["}],["$","span","13",{"className":"styles_number__dhAtQ","children":"0"}],["$","span","14",{"className":"","children":"]"}],["$","span","15",{"className":"","children":";"}],["$","span","16",{"className":"","children":""}]]}],["$","div","9",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      parts"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"push"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"styles_operator__ty4_w","children":"..."}],["$","span","5",{"className":"","children":"nestedParts"}],["$","span","6",{"className":"","children":"."}],["$","span","7",{"className":"styles_function__1eRN9","children":"slice"}],["$","span","8",{"className":"","children":"("}],["$","span","9",{"className":"styles_number__dhAtQ","children":"1"}],["$","span","10",{"className":"","children":")"}],["$","span","11",{"className":"","children":")"}],["$","span","12",{"className":"","children":";"}],["$","span","13",{"className":"","children":""}]]}],["$","div","10",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      parts"}],["$","span","1",{"className":"","children":"["}],["$","span","2",{"className":"","children":"parts"}],["$","span","3",{"className":"","children":"."}],["$","span","4",{"className":"","children":"length "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"-"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"styles_number__dhAtQ","children":"1"}],["$","span","8",{"className":"","children":"]"}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":"styles_operator__ty4_w","children":"+="}],["$","span","11",{"className":"","children":" nestedParts"}],["$","span","12",{"className":"","children":"["}],["$","span","13",{"className":"","children":"index"}],["$","span","14",{"className":"","children":"]"}],["$","span","15",{"className":"","children":";"}],["$","span","16",{"className":"","children":""}]]}],["$","div","11",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      binds"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"push"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"styles_operator__ty4_w","children":"..."}],["$","span","5",{"className":"","children":"nestedBinds"}],["$","span","6",{"className":"","children":")"}],["$","span","7",{"className":"","children":";"}],["$","span","8",{"className":"","children":""}]]}],["$","div","12",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_keyword__RcxoL","children":"else"}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"","children":"{"}],["$","span","6",{"className":"","children":""}]]}],["$","div","13",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      parts"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"push"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"nestedParts"}],["$","span","5",{"className":"","children":"["}],["$","span","6",{"className":"","children":"index"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":";"}],["$","span","10",{"className":"","children":""}]]}],["$","div","14",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      binds"}],["$","span","1",{"className":"","children":"."}],["$","span","2",{"className":"styles_function__1eRN9","children":"push"}],["$","span","3",{"className":"","children":"("}],["$","span","4",{"className":"","children":"bind"}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":";"}],["$","span","7",{"className":"","children":""}]]}],["$","div","15",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","16",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":")"}],["$","span","3",{"className":"","children":";"}],["$","span","4",{"className":"","children":""}]]}],["$","div","17",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" binds"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","18",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","19",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","20",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":" styles_function__1eRN9","children":"makeQuery"}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"="}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"execute"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","12",{"className":"","children":" "}],["$","span","13",{"className":"styles_function__1eRN9","children":"query"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"","children":"inParts"}],["$","span","16",{"className":" ","children":","}],["$","span","17",{"className":"","children":" "}],["$","span","18",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","19",{"className":"","children":"inBinds"}],["$","span","20",{"className":"","children":")"}],["$","span","21",{"className":"","children":" "}],["$","span","22",{"className":"","children":"{"}],["$","span","23",{"className":"","children":""}]]}],["$","div","21",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" binds"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"="}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"styles_function__1eRN9","children":"compile"}],["$","span","12",{"className":"","children":"("}],["$","span","13",{"className":"","children":"inParts"}],["$","span","14",{"className":"","children":","}],["$","span","15",{"className":"","children":" inBinds"}],["$","span","16",{"className":"","children":")"}],["$","span","17",{"className":"","children":";"}],["$","span","18",{"className":"","children":""}]]}],["$","div","22",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"{"}]]}]]}]}]]}],["$","section",null,{"id":"Async%20Iteration","children":[["$","h2",null,{"children":"Async Iteration"}],["$","p",null,{"children":"One final feature I wanted to add as a performance optimization was async iteration. When I was developing this tool, I was loading a lot of data from the database during jobs, but only needed one record at a time."}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_ styles_highlit__JjWSK","children":[["$","div","0",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"async"}],["$","span","1",{"className":"","children":" "}],["$","span","2",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","3",{"className":"","children":" "}],["$","span","4",{"className":"styles_function__1eRN9","children":"collect"}],["$","span","5",{"className":"","children":"("}],["$","span","6",{"className":"","children":"iterator"}],["$","span","7",{"className":"","children":")"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"","children":"{"}],["$","span","10",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" arr "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"","children":"["}],["$","span","6",{"className":"","children":"]"}],["$","span","7",{"className":"","children":";"}],["$","span","8",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"for"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_keyword__RcxoL","children":"await"}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"","children":"("}],["$","span","6",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","7",{"className":"","children":" item "}],["$","span","8",{"className":"styles_keyword__RcxoL","children":"of"}],["$","span","9",{"className":"","children":" iterator"}],["$","span","10",{"className":"","children":")"}],["$","span","11",{"className":"","children":" arr"}],["$","span","12",{"className":"","children":"."}],["$","span","13",{"className":"styles_function__1eRN9","children":"push"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"","children":"item"}],["$","span","16",{"className":"","children":")"}],["$","span","17",{"className":"","children":";"}],["$","span","18",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" arr"}],["$","span","3",{"className":"","children":";"}],["$","span","4",{"className":"","children":""}]]}],["$","div","4",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","5",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"\n"}]]}],["$","div","6",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":" styles_function__1eRN9","children":"makeQuery"}],["$","span","4",{"className":"","children":" "}],["$","span","5",{"className":"styles_operator__ty4_w","children":"="}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"execute"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","10",{"className":"","children":" "}],["$","span","11",{"className":"styles_keyword__RcxoL","children":"function"}],["$","span","12",{"className":"","children":" "}],["$","span","13",{"className":"styles_function__1eRN9","children":"query"}],["$","span","14",{"className":"","children":"("}],["$","span","15",{"className":"","children":"parts"}],["$","span","16",{"className":" ","children":","}],["$","span","17",{"className":"","children":" "}],["$","span","18",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","19",{"className":"","children":"binds"}],["$","span","20",{"className":"","children":")"}],["$","span","21",{"className":"","children":" "}],["$","span","22",{"className":"","children":"{"}],["$","span","23",{"className":"","children":""}]]}],["$","div","7",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"{"}],["$","span","4",{"className":"","children":""}]]}],["$","div","8",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"["}],["$","span","2",{"className":"","children":"toQuery"}],["$","span","3",{"className":"","children":"]"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}],["$","span","8",{"className":"","children":""}]]}],["$","div","9",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"","children":"["}],["$","span","4",{"className":"","children":"parts"}],["$","span","5",{"className":"","children":","}],["$","span","6",{"className":"","children":" binds"}],["$","span","7",{"className":"","children":"]"}],["$","span","8",{"className":"","children":";"}],["$","span","9",{"className":"","children":""}]]}],["$","div","10",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":","}],["$","span","3",{"className":"","children":""}]]}],["$","div","11",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"styles_function__1eRN9","children":"then"}],["$","span","2",{"className":"","children":"("}],["$","span","3",{"className":" styles_operator__ty4_w","children":"..."}],["$","span","4",{"className":"","children":"args"}],["$","span","5",{"className":"","children":")"}],["$","span","6",{"className":"","children":" "}],["$","span","7",{"className":"","children":"{"}],["$","span","8",{"className":"","children":""}]]}],["$","div","12",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_function__1eRN9","children":"collect"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"styles_keyword__RcxoL","children":"this"}],["$","span","6",{"className":"","children":")"}],["$","span","7",{"className":"","children":"."}],["$","span","8",{"className":"styles_function__1eRN9","children":"then"}],["$","span","9",{"className":"","children":"("}],["$","span","10",{"className":"styles_operator__ty4_w","children":"..."}],["$","span","11",{"className":"","children":"args"}],["$","span","12",{"className":"","children":")"}],["$","span","13",{"className":"","children":";"}],["$","span","14",{"className":"","children":""}]]}],["$","div","13",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":","}],["$","span","3",{"className":"","children":""}]]}],["$","div","14",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"["}],["$","span","2",{"className":"","children":"Symbol"}],["$","span","3",{"className":"","children":"."}],["$","span","4",{"className":"","children":"asyncIterator"}],["$","span","5",{"className":"","children":"]"}],["$","span","6",{"className":"","children":"("}],["$","span","7",{"className":"","children":")"}],["$","span","8",{"className":"","children":" "}],["$","span","9",{"className":"","children":"{"}],["$","span","10",{"className":"","children":""}]]}],["$","div","15",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"      "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" "}],["$","span","3",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","4",{"className":"","children":"("}],["$","span","5",{"className":"","children":"parts"}],["$","span","6",{"className":"","children":","}],["$","span","7",{"className":"","children":" binds"}],["$","span","8",{"className":"","children":")"}],["$","span","9",{"className":"","children":";"}],["$","span","10",{"className":"","children":""}]]}],["$","div","16",{"className":"styles_line__aOS_T styles_highlight__lqo_T","children":[["$","span","0",{"className":"","children":"    "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":","}],["$","span","3",{"className":"","children":""}]]}],["$","div","17",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":""}]]}],["$","div","18",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}]]}]]}]}],["$","p",null,{"children":"This also requires a change to the execute function as well, which will depend greatly on the database library."}],["$","div",null,{"className":"styles_p__HqdKC","children":["$","div",null,{"className":"styles_container__jy1l_","children":[["$","div","0",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","1",{"className":"","children":" query "}],["$","span","2",{"className":"styles_operator__ty4_w","children":"="}],["$","span","3",{"className":"","children":" "}],["$","span","4",{"className":"styles_function__1eRN9","children":"makeQuery"}],["$","span","5",{"className":"","children":"("}],["$","span","6",{"className":"","children":"("}],["$","span","7",{"className":"","children":"parts"}],["$","span","8",{"className":" ","children":","}],["$","span","9",{"className":"","children":" binds"}],["$","span","10",{"className":"","children":")"}],["$","span","11",{"className":"","children":" "}],["$","span","12",{"className":"styles_operator__ty4_w","children":"=>"}],["$","span","13",{"className":"","children":" "}],["$","span","14",{"className":"","children":"{"}],["$","span","15",{"className":"","children":""}]]}],["$","div","1",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"const"}],["$","span","2",{"className":"","children":" result "}],["$","span","3",{"className":"styles_operator__ty4_w","children":"="}],["$","span","4",{"className":"","children":" connection"}],["$","span","5",{"className":"","children":"."}],["$","span","6",{"className":"styles_function__1eRN9","children":"execute"}],["$","span","7",{"className":"","children":"("}],["$","span","8",{"className":"","children":"{"}],["$","span","9",{"className":"","children":" "}],["$","span","10",{"className":" styles_property__BaBI9","children":"sql"}],["$","span","11",{"className":"styles_operator__ty4_w","children":":"}],["$","span","12",{"className":"","children":" parts"}],["$","span","13",{"className":"","children":"."}],["$","span","14",{"className":"styles_function__1eRN9","children":"join"}],["$","span","15",{"className":"","children":"("}],["$","span","16",{"className":"styles_string__bCSta","children":"\"$\""}],["$","span","17",{"className":"","children":")"}],["$","span","18",{"className":"","children":","}],["$","span","19",{"className":"","children":" binds "}],["$","span","20",{"className":"","children":"}"}],["$","span","21",{"className":"","children":")"}],["$","span","22",{"className":"","children":";"}],["$","span","23",{"className":"","children":""}]]}],["$","div","2",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":"  "}],["$","span","1",{"className":"styles_keyword__RcxoL","children":"return"}],["$","span","2",{"className":"","children":" result"}],["$","span","3",{"className":"","children":"."}],["$","span","4",{"className":"styles_function__1eRN9","children":"streamRows"}],["$","span","5",{"className":"","children":"("}],["$","span","6",{"className":"","children":")"}],["$","span","7",{"className":"","children":";"}],["$","span","8",{"className":"","children":""}]]}],["$","div","3",{"className":"styles_line__aOS_T ","children":[["$","span","0",{"className":"","children":""}],["$","span","1",{"className":"","children":"}"}],["$","span","2",{"className":"","children":")"}]]}]]}]}]]}],["$","section",null,{"id":"Conclusion","children":[["$","h2",null,{"children":"Conclusion"}],["$","p",null,{"children":"This tool can be a great help for certain scenarios, particularly those that are using complex SQL queries, probably doing some kind of data analysis. But for more typical transactional workflows, query builders or even an ORM can better suited to the task."}]]}]]}]]}]]}]
